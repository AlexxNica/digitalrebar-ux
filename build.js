!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},o={},n={},r={}.hasOwnProperty,a=/^\.\.?(\/|$)/,i=function(e,t){for(var o,n=[],r=(a.test(t)?e+"/"+t:t).split("/"),i=0,s=r.length;i<s;i++)o=r[i],".."===o?n.pop():"."!==o&&""!==o&&n.push(o);return n.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t){return function(o){var n=i(s(t),o);return e.require(n,t)}},d=function(e,t){var n=h&&h.createHot(e),r={id:e,exports:{},hot:n};return o[e]=r,t(r.exports,l(e),r),r.exports},c=function(e){return n[e]?c(n[e]):e},p=function(e,t){return c(i(s(e),t))},u=function(e,n){null==n&&(n="/");var a=c(e);if(r.call(o,a))return o[a].exports;if(r.call(t,a))return d(a,t[a]);throw new Error("Cannot find module '"+e+"' from '"+n+"'")};u.alias=function(e,t){n[t]=e};var m=/\.[^.\/]+$/,f=/\/index(\.[^\/]+)?$/,v=function(e){if(m.test(e)){var t=e.replace(m,"");r.call(n,t)&&n[t].replace(m,"")!==t+"/index"||(n[t]=e)}if(f.test(e)){var o=e.replace(f,"");r.call(n,o)||(n[o]=e)}};u.register=u.define=function(e,n){if(e&&"object"==typeof e)for(var a in e)r.call(e,a)&&u.register(a,e[a]);else t[e]=n,delete o[e],v(e)},u.list=function(){var e=[];for(var o in t)r.call(t,o)&&e.push(o);return e};var h=e._hmr&&new e._hmr(p,u,t,o);u._cache=o,u.hmr=h&&h.wrap,u.brunch=!0,e.require=u}}(),function(){"undefined"==typeof window?this:window;require.register("js/app.js",function(e,t,o){"use strict";window.version="0.2.0",function(){var e=angular.module("app",["ngRoute","ngMaterial","ngCookies","ngAnimate","sparkline","LocalStorageModule","DigestAuthInterceptor","md.data.table","debounce","jsontext","ng-slide-down","swapMdPaint","angular-clipboard","ngMessages","ngVis","ngOrderObjectBy","ui.ace"]);e.config(["$httpProvider","$routeProvider","$mdThemingProvider","apiProvider",function(e,t,o,n){e.interceptors.push("digestAuthInterceptor"),o.theme("default").primaryPalette("blue",{"default":"800","hue-1":"50"}).accentPalette("red"),o.theme("input","default").primaryPalette("grey"),o.theme("status_").primaryPalette("green",{"default":"600"}).accentPalette("grey",{"default":"900"}),o.theme("status_ready").primaryPalette("green",{"default":"600"}).accentPalette("grey",{"default":"900"}),o.theme("status_error").primaryPalette("red",{"default":"700"}).accentPalette("grey",{"default":"900"}),o.theme("status_process").primaryPalette("yellow",{"default":"600"}).accentPalette("grey",{"default":"900"}),o.theme("status_todo").primaryPalette("yellow",{"default":"300"}).accentPalette("grey",{"default":"900"}),o.theme("status_off").primaryPalette("grey",{"default":"900"}).accentPalette("red",{"default":"900"}),o.theme("status_queue").primaryPalette("yellow",{"default":"100"}).accentPalette("grey",{"default":"900"}),o.theme("status_reserved").primaryPalette("blue",{"default":"500"}).accentPalette("grey",{"default":"900"}),o.theme("status_proposed").primaryPalette("blue",{"default":"400"}).accentPalette("grey",{"default":"900"}),o.alwaysWatchTheme(!0),t.when("/",{redirectTo:"/welcome"}).when("/welcome",{controller:"WelcomeCtrl",controllerAs:"welcome",templateUrl:"views/welcome.html"}).when("/deployments",{controller:"DeploymentsCtrl",controllerAs:"deployments",templateUrl:"views/deployments.html"}).when("/deployments/:id",{controller:"DeploymentsCtrl",controllerAs:"deployments",templateUrl:"views/deployments.html"}).when("/login",{controller:"LoginCtrl",controllerAs:"login",templateUrl:"views/login.html"}).when("/nodes",{controller:"NodesCtrl",controllerAs:"nodes",templateUrl:"views/nodes.html"}).when("/nodes/:id",{controller:"NodesCtrl",controllerAs:"nodes",templateUrl:"views/nodes_singular.html"}).when("/node_roles",{controller:"NodeRolesCtrl",controllerAs:"node_roles",templateUrl:"views/node_roles.html"}).when("/node_roles/:id",{controller:"NodeRolesCtrl",controllerAs:"node_roles",templateUrl:"views/node_roles_singular.html"}).when("/roles",{controller:"RolesCtrl",controllerAs:"roles",templateUrl:"views/roles.html"}).when("/roles/:id",{controller:"RolesCtrl",controllerAs:"roles",templateUrl:"views/roles_singular.html"}).when("/deployment_roles",{controller:"DeploymentRolesCtrl",controllerAs:"deployment_roles",templateUrl:"views/deployment_roles.html"}).when("/deployment_roles/:id",{controller:"DeploymentRolesCtrl",controllerAs:"deployment_roles",templateUrl:"views/deployment_roles_singular.html"}).when("/barclamps",{controller:"BarclampsCtrl",controllerAs:"barclamps",templateUrl:"views/barclamps.html"}).when("/barclamps/:id",{controller:"BarclampsCtrl",controllerAs:"barclamps",templateUrl:"views/barclamps_singular.html"}).when("/networks",{controller:"NetworksCtrl",controllerAs:"networks",templateUrl:"views/networks.html"}).when("/networks/:id",{controller:"NetworksCtrl",controllerAs:"networks",templateUrl:"views/networks_singular.html"}).when("/switches",{controller:"SwitchesCtrl",controllerAs:"switches",templateUrl:"views/switches.html"}).when("/providers",{controller:"ProviderCtrl",controllerAs:"providers",templateUrl:"views/provider.html"}).when("/providers/:id",{controller:"ProviderCtrl",controllerAs:"providers",templateUrl:"views/provider.html"}).when("/annealer",{controller:"AnnealerCtrl",controllerAs:"annealer",templateUrl:"views/annealer.html"}).when("/users",{controller:"UsersCtrl",controllerAs:"users",templateUrl:"views/users.html"}).when("/users/:id",{controller:"UsersCtrl",controllerAs:"users",templateUrl:"views/users.html"}).when("/tenants",{controller:"TenantsCtrl",controllerAs:"tenants",templateUrl:"views/tenants.html"}).when("/tenants/:id",{controller:"TenantsCtrl",controllerAs:"tenants",templateUrl:"views/tenants.html"}).when("/capabilities",{controller:"CapabilitiesCtrl",controllerAs:"capabilities",templateUrl:"views/capabilities.html"}).when("/bios/settings",{controller:"BiosSettingsCtrl",controllerAs:"biossettings",templateUrl:"views/bios_settings.html"}).when("/bios/updates",{controller:"BiosUpdatesCtrl",controllerAs:"biosupdates",templateUrl:"views/bios_updates.html"}).when("/dns",{controller:"DNSCtrl",controllerAs:"dns",templateUrl:"views/dns.html"}).when("/dhcp",{controller:"DHCPCtrl",controllerAs:"dhcp",templateUrl:"views/dhcp.html"}).when("/engine",{controller:"EngineCtrl",controllerAs:"engine",templateUrl:"views/engine.html"}).when("/provisioner/templates",{controller:"ProvisionerCtrl",controllerAs:"provisioner",templateUrl:"views/provisioner_templates.html"}).when("/provisioner/templates/:id",{controller:"ProvisionerCtrl",controllerAs:"provisioner",templateUrl:"views/provisioner_templates.html"}).when("/provisioner/bootenvs",{controller:"ProvisionerCtrl",controllerAs:"provisioner",templateUrl:"views/provisioner_bootenvs.html"}).when("/provisioner/bootenvs/:id",{controller:"ProvisionerCtrl",controllerAs:"provisioner",templateUrl:"views/provisioner_bootenvs.html"}).when("/provisioner/machines",{controller:"ProvisionerCtrl",controllerAs:"provisioner",templateUrl:"views/provisioner_machines.html"}).when("/provisioner/machines/:id",{controller:"ProvisionerCtrl",controllerAs:"provisioner",templateUrl:"views/provisioner_machines.html"}).when("/profiles",{controller:"ProfileCtrl",controllerAs:"profiles",templateUrl:"views/profiles.html"}).when("/profiles/:id",{controller:"ProfileCtrl",controllerAs:"profiles",templateUrl:"views/profiles.html"}).when("/workloads/:id",{controller:"WorkloadsCtrl",controllerAs:"workloads",templateUrl:"views/workloads.html"}).when("/alerts",{controller:"LoggingCtrl",controllerAs:"logging",templateUrl:"views/logging.html"}).when("/api_helper",{controller:"ApiHelperCtrl",controllerAs:"apiHelper",templateUrl:"views/api_helper.html"}).when("/attribs",{controller:"AttribsCtrl",controllerAs:"attribs",templateUrl:"views/attribs.html"}).when("/graphs",{controller:"GraphsCtrl",controllerAs:"graphs",templateUrl:"views/graphs.html"}).otherwise({redirectTo:"/welcome"})}]),e.filter("not",function(){return function(e,t){var o={};return angular.forEach(e,function(e,n){e[t]||(o[n]=e)}),o}}),e.filter("has",function(){return function(e,t){var o={};return angular.forEach(e,function(e,n){e[t]&&(o[n]=e)}),o}}),e.filter("json",function(){return function(e){return JSON.stringify(e,null,"  ")}}),e.directive("elastic",["$timeout",function(e){return{restrict:"A",link:function(t,o){t.initialHeight=t.initialHeight||o[0].style.height;var n=function(){o[0].style.height=t.initialHeight,o[0].style.height=""+o[0].scrollHeight+"px"};o.on("input change",n),e(n,0)}}}]),e.directive("scrollPosition",[function(){return{scope:{scroll:"=scrollPosition"},link:function(e,t){var o=function(){e.scroll=$(t).scrollTop()};t.on("scroll",e.$apply.bind(e,o)),o()}}}]),e.component("fancylist",{templateUrl:"views/components/fancylist.html",bindings:{initial:"@",title:"@",path:"@"},controller:["$scope","$attrs","$parse",function(e,t,o){function n(e){e&&(r.items=e.map(a))}var r=this,a=e.$parent[t.mapping],i=e.$parent.$watchCollection(o(t.items),n);e.$on("$destroy",i),e.list=!0,e.myOrder="order",e.toggleList=function(){e.list=!e.list,e.myOrder="order"}}]}),e.controller("AppCtrl",["$scope","$location","localStorageService","$mdSidenav","api",function(e,t,o,n,r){e.toggleSideNav=function(e){n(e).toggle()},e.api=r,e.scroll=0,e.menu=[{title:"Deployments",icon:"dashboard",path:"/deployments"},{title:"App Catalog",icon:"work",expand:!0,expanded:function(){return e.expandWorkloads},toggleExpand:e.toggleExpandWorkloads,items:e.wizardBarclamps},{title:"Providers",icon:"filter_drama",path:"/providers"},{title:"Nodes",icon:"dns",path:"/nodes"},{title:"Profiles",icon:"group_work",path:"/profiles"},{title:"Networks",icon:"swap_horiz",path:"/networks"}],e.managementMenu=[{title:"Services",icon:"tune",expand:!0,expanded:function(){return e.expandServices},toggleExpand:e.toggleExpandServices,items:[{title:"Rule Engine",icon:"settings_input_composite",path:"/engine",hide:function(){return!e.showEngine}},{title:"DHCP Subnets",icon:"device_hub",path:"/dhcp",hide:function(){return!e.showDHCP}},{title:"DNS Zones",icon:"public",path:"/dns",hide:function(){return!e.showDNS}}]},{title:"Firmware",icon:"computer",expand:!0,expanded:function(){return e.expandHardware},toggleExpand:e.toggleExpandHardware,items:[{title:"BIOS Settings",icon:"map",path:"/bios/settings",hide:function(){return!e.showBiosSettings}},{title:"Firmware Updates",icon:"healing",path:"/bios/updates",hide:function(){return!e.showBiosUpdates}}]},{title:"Provisioner",icon:"local_shipping",hide:function(){return!e.showProvisioner},expand:!0,expanded:function(){return e.expandProvisioner},toggleExpand:e.toggleExpandProvisioner,items:[{title:"Machines",icon:"dns",path:"/provisioner/machines"},{title:"Boot Environments",icon:"album",path:"/provisioner/bootenvs"},{title:"Templates",icon:"insert_drive_file",path:"/provisioner/templates"}]},{title:"Access",icon:"lock",expand:!0,expanded:function(){return e.expandAccess},toggleExpand:e.toggleExpandAccess,items:[{title:"Users",icon:"person",path:"/users"},{title:"Tenants",icon:"group",path:"/tenants"},{title:"Capabilities",icon:"traffic",path:"/capabilities"}]},{title:"Alerts",icon:"error",path:"/alerts"},{title:"Advanced",icon:"build",expand:!0,expanded:function(){return e.expandAdvanced},toggleExpand:e.toggleExpandAdvanced,items:[{title:"API Call Helper",icon:"cloud_upload",path:"/api_helper"},{title:"Workloads/Barclamps",icon:"attach_file",path:"/barclamps"},{title:"Roles",icon:"label_outline",path:"/roles"},{title:"Attributes",icon:"list",path:"/attribs"},{title:"Graphs",icon:"pie_chart_outlined",path:"/graphs"}]}],e.setPath=function(e){t.path(e)},e.logout=function(){sessionStorage.clear(),localStorage.clear(),o.add("username",""),o.add("password",""),e.confirm(event,{title:"Cannot Loggout",message:"At this time, you must close the browser to change user sessions"})}}]),e.run(["$rootScope","$location","$http","$cookies","debounce","$interval","localStorageService","api","$mdDialog","$mdMedia",function(e,t,o,n,r,a,i,s,l,d){e.user,e.isAuth=function(){return!!e.user},e.lastPath="/",e.expandServices=!1,e.toggleExpandServices=function(){e.expandServices=!e.expandServices},e.expandHardware=!1,e.toggleExpandHardware=function(){e.expandHardware=!e.expandHardware},e.expandProvisioner=!1,e.toggleExpandProvisioner=function(){e.expandProvisioner=!e.expandProvisioner},e.expandAccess=!1,e.toggleExpandAccess=function(){e.expandAccess=!e.expandAccess},e.expandAdvanced=!1,e.toggleExpandAdvanced=function(){e.expandAdvanced=!e.expandAdvanced},e.expandWorkloads=!1,e.toggleExpandWorkloads=function(){e.expandWorkloads=!e.expandWorkloads},e.setTenant=function(t){s("/api/v2/users/"+e.user.id,{method:"PUT",data:{current_tenant_id:t}}).then(function(t){e.user=t.data,s.reload()})},e.$on("$locationChangeStart",function(o,r){var a=r.split("/#!/")[1];if(a=a?a.toLowerCase():"deployments",!e.isAuth()){var i=n.get("DrAuthToken"),s=n.get("DrAuthUser");if("undefined"!=typeof i)e.$emit("login",{username:s}),e.$emit("startUpdating");else if("login"!==a)return e.lastPath="/"+a,void t.path("/login")}"login"===a&&e.isAuth()&&t.path("/")}),e.$on("login",function(t,o){e.user=o,s("/api/v2/users/"+o.username).then(function(t){e.user=t.data}),s("/api/v2/providers/templates").then(function(t){e.providerTemplates=t.data})}),e.$on("host",function(t,o){e.host=o}),e.$on("title",function(t,o){e.title=o}),e.showEditAttribDialog=function(e,t,o){var n=d("sm")||d("xs");l.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/editattribdialog.tmpl.html",parent:angular.element(document.body),targetEvent:e,locals:{id:t.id,value:JSON.stringify(t.value,null,"  "),attrib:t,api:s,target:o},clickOutsideToClose:!0,fullscreen:n})},e.confirm=function(e,t){var o=l.confirm().title(t.title||"Confirm").textContent(t.message).targetEvent(e).ok(t.yes||"Yes").cancel(t.no||"No");l.show(o).then(function(){"undefined"!=typeof t.yesCallback&&t.yesCallback()},function(){"undefined"!=typeof t.noCallback&&t.noCallback()})},window.onkeydown=function(t){var o=t.keyCode?t.keyCode:t.which,n=t.ctrlKey,r=t.altKey,a=t.shiftKey;e.$evalAsync(function(){e.$broadcast("keyDown",{key:o,ctrl:n,alt:r,shift:a})})},e.icons={ready:"check_circle",error:"warning",process:"autorenew",todo:"play_circle_outline",off:"power_settings_new",queue:"update",reserved:"pause_circle_outline",proposed:"add_circle_outline"},e.states={"-1":"error",0:"ready",1:"todo",2:"process",3:"queue",4:"proposed"}}])}()}),require.register("js/annealer.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("AnnealerCtrl",["$scope","api",function(e,t){e.$emit("title","Annealer"),e.selected=-1,e.setNode=function(t){e.$emit("title","Annealer "+(t!==-1?"("+e._nodes[t].name+")":"")),e.selected=t},e.getNodeRoles=function(t){var o=[];for(var n in e._node_roles){var r=e._node_roles[n];t===r.status&&o.push(r)}return o},e.retryAll=function(){e.getNodeRoles("error").forEach(function(e){t("/api/v2/node_roles/"+e.id+"/retry",{method:"PUT"}).then(function(e){t.addNodeRole(e.data)})})},e.statesList=["error","process","todo","queue"]}])}()}),require.register("js/attribs.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("AttribsCtrl",["$scope","$location","debounce","$routeParams","$mdMedia","$mdDialog","$timeout","api",function(e,t,o,n,r,a,i,s){e.$emit("title","Attributes"),e.myOrder="name",e.hasAttrib=-1,e.attribs=[],e.editing=!1,e.hasAttrib===-1&&s("/api/v2/attribs").then(function(t){e.attribs=t.data,e.hasAttrib=1},function(){e.hasAttrib=0})}])}()}),require.register("js/barclamps.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("BarclampsCtrl",["$scope","$location","debounce","$routeParams","$mdMedia","$mdDialog","api",function(e,t,o,n,r,a,i){function s(){e.barclamp=e._barclamps[e.id],e.barclamp?l||(l=!0,e.$on("barclamp"+e.barclamp.id+"Done",s)):t.path("/barclamps")}e.$emit("title","Barclamps"),e.myOrder="name",e.getBarclamps=function(){var t=[];for(var o in e._barclamps)t.push(e._barclamps[o]);return t},e.getRoles=function(t){if(!t)return[];t=t.map(function(e){return e.name});var o=[];for(var n in e._roles){var r=e._roles[n];t.includes(r.name)&&o.push(r)}return o},e.selectedFile="",e.selectFile=function(){document.getElementById("file").click()},e.upload=function(){var t=document.getElementById("file");e.selectedFile="";var o=t.files[0],n=new FileReader;n.onloadend=function(e){var t=e.target.result;i.addBarclamp(t)},n.readAsBinaryString(o),t.value=""},this.showUpdateBarclampDialog=function(t){var o=r("sm")||r("xs"),n=e.barclamp;if(!n){var i="id"+Math.round(1e4*Math.random());e.barclamp={name:i,cfg_data:{barclamp:{name:"workload_"+i,description:"User Created Workload "+i,version:"0.0"},roles:[{name:"user_role_"+i,description:"User Created Role "+i,jig:"script",metadata:{scripts:['#!/bin/bash\necho "Show Available Attributes"\ncat $TMPDIR/attrs.json | jq .\nexit 0\n']}}]}}}a.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/updatebarclampdialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{barclamp:e.barclamp},clickOutsideToClose:!0,fullscreen:o})},e.id=n.id,e.barclamp={};var l=!1;Object.keys(e._barclamps).length?s():e.$on("barclampsDone",s)}])}()}),require.register("js/bios_settings.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("BiosSettingsCtrl",["$mdMedia","$mdDialog","$scope","$http","debounce","$timeout","api",function(e,t,o,n,r,a,i){o.$emit("title","BIOS Settings"),o.expand=[],o.dirty=!1,o.settings=[],o.role=-1,o.deployment_role=-1,o.id=-1,o.loadSettings=function(){i.get_id("/api/v2/roles/bios-discover").then(function(e){o.role=e.data.id,i("/api/v2/deployments/system/deployment_roles").then(function(e){var t=e.data;for(var n in t)if(t[n].role_id===o.role){o.deployment_role=t[n].id;break}i("/api/v2/deployment_roles/"+o.deployment_role+"/attribs/bios-set-mapping").then(function(e){var t=e.data;o.dirty=!1,o.id=t.id,o.settings=[],t.value.forEach(function(e){e.configs.forEach(function(t){var n={};n.role=e.role;for(var r in o._roles)if(o._roles[r].name===e.role){n.role_id=o._roles[r].id;break}n.name=t.name,n.parent=t.parent,n.match=[],n.values=[],Object.keys(e.match).forEach(function(t){var o={id:t};"string"==typeof e.match[t]?(o.pattern=e.match[t],o.op="exact"):(o.pattern=e.match[t].match,o.op=e.match[t].op),n.match.push(o)}),Object.keys(t.settings).forEach(function(e){var o={id:e,value:t.settings[e]};n.values.push(o)}),o.settings.push(n)})})},function(e){i.toast("Error Bios Setting Data","bios_setting",e.data)})})})},this.dirtyData=function(){o.dirty=!0},this.toggleExpand=function(e){o.expand[e]=!o.expand[e]},o.removeValue=function(e,t,n){for(var r in o.settings[e][t])if(o.settings[e][t][r].id===n){o.settings[e][t].splice(r,1),i.toast("Removed "+t+" "+n,t,e),o.dirty=!0;break}},o.addValue=function(e,t){var n={id:"not set",value:"undefined",op:"exact"};o.settings[e][t].push(n),o.dirty=!0},o.createHardwareSectionPrompt=function(e,n,r){var a=t.prompt().title("Creating Section for "+o.settings[n].name).textContent("Section Name:").placeholder("default").ariaLabel("Section").targetEvent(e).ok("Add").cancel("Cancel");t.show(a).then(function(e){var t={role:o.settings[n].role,name:e,parent:r,match:[],values:[]};o.settings.push(t)},function(){console.log("did not create")})},o.createHardwareClassPrompt=function(e){var n=t.prompt().title("Creating Hardware Class:").textContent("Role:Group Name.").placeholder("role:default").ariaLabel("Role:Class").targetEvent(e).ok("Add").cancel("Cancel");t.show(n).then(function(e){var t=e.split(":"),n={role:t[0],name:t[1]||"default",match:[],values:[]};o.settings.push(n)},function(){console.log("did not create")})},o.saveSetting=function(){var e={};o.settings.forEach(function(t){e[t.role]||(e[t.role]={role:t.role,configs:[],match:{}});var o={name:t.name,settings:{}};t.parent&&(o.parent=t.parent),t.values.forEach(function(e){o.settings[e.id]=e.value}),e[t.role].configs.push(o),"default"===t.name&&t.match.forEach(function(o){"exact"===o.op?e[t.role].match[o.id]=o.pattern:e[t.role].match[o.id]={op:o.op,match:o.pattern,__sm_leaf:"true,"}})});var t=[];for(var n in e)t.push(e[n]);var r={value:t};r.deployment_role_id=o.deployment_role,i("/api/v2/deployment_roles/"+o.deployment_role+"/propose",{method:"PUT"}).then(function(){i("/api/v2/attribs/"+o.id,{method:"PUT",data:r}).then(function(){i.toast("Updated Attrib!"),i("/api/v2/deployment_roles/"+o.deployment_role+"/commit",{method:"PUT"}).then(function(){i.toast("Committed!"),o.dirty=!1})},function(e){i.toast("Error updating values","attribs",e.data)})})},o.deleteSetting=function(e,t){o.dirty=!0,delete o.settings[t]},o.loadSettings()}])}()}),require.register("js/bios_updates.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("BiosUpdatesCtrl",["$mdMedia","$mdDialog","$scope","$http","debounce","$timeout","api",function(e,t,o,n,r,a,i){o.$emit("title","Firmware Updates"),o.expand={},o.dirty=!1,o.updates=[],o.role=-1,o.deployment_role=-1,o.id=-1,o.attribute="bios-firmware-list",o.attributes={"bios-firmware-list":"BIOS","ipmi-firmware-list":"IPMI"},o.loadUpdates=function(){i("/api/v2/roles/bios-flash").then(function(e){var t=e.data;o.role=t.id,i("/api/v2/deployments/system/deployment_roles").then(function(e){var t=e.data;for(var n in t)if(t[n].role_id===o.role){o.deployment_role=t[n].id;break}i("/api/v2/deployment_roles/"+o.deployment_role+"/attribs/"+o.attribute).then(function(e){var t=e.data,n=t.value;o.updates=[],o.dirty=!1,o.id=t.id,n.forEach(function(e){var t={};t.match={},t["package"]={},Object.keys(e).forEach(function(o){"package"===o||"package-sha256sum"===o||"package-source"===o||"script"===o?t["package"][o]=e[o]:t.match[o]={id:o,value:e[o]}}),o.updates.push(t)})},function(e){i.toast("Error Firmware Updates Data",o.attribute,e.data)})})})},this.toggleExpand=function(e){o.expand[e]=!o.expand[e]},this.dirtyData=function(){o.dirty=!0},o.removeValue=function(e,t){delete o.updates[e].match[t],i.toast("Removed Match "+t,"match",e),o.dirty=!0},o.addValue=function(e){o.updates[e].match["not set"]={id:"not set",value:"undefined"},o.dirty=!0},o.createUpdate=function(e){var n=t.prompt().title("Creating Package").textContent("Package Name:").placeholder("default").ariaLabel("Package").targetEvent(e).ok("Add").cancel("Cancel");t.show(n).then(function(e){var t={match:{"bios-version":{id:"bios-version",value:"0.0.0"},system_product:{id:"system_product",value:"model"},system_manufacturer:{id:"vendor",value:"system_manufacturer"}},"package":{"package":e,script:"#!/usr/bin/env bash","package-source":"http://","package-sha256sum":"not set"}};o.updates.push(t),o.dirty=!0},function(){console.log("did not create")})},o.saveSetting=function(){var e=[],t=function(t){var n={script:o.updates[t]["package"].script,"package":o.updates[t]["package"]["package"],"package-source":o.updates[t]["package"]["package-source"],"package-sha256sum":o.updates[t]["package"]["package-sha256sum"]},r=o.updates[t].match;Object.keys(r).forEach(function(e){n[r[e].id]=r[e].value}),e.push(n)};for(var n in o.updates)t(n);var r={value:e};r.deployment_role_id=o.deployment_role,i("/api/v2/deployment_roles/"+o.deployment_role+"/propose",{method:"PUT"}).then(function(){i("/api/v2/attribs/"+o.id,{method:"PUT",data:r}).then(function(){i("/api/v2/deployment_roles/"+o.deployment_role+"/commit",{method:"PUT"}).then(function(){i.toast("Updated Firmware Attrib!")})},function(e){i.toast("Error updating firmware values","attribs",e.data)})})},o.deleteSetting=function(e,t){delete o.updates[t]},o.loadUpdates()}])}()}),require.register("js/capabilities.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("CapabilitiesCtrl",["$scope","api","$mdMedia","$mdDialog",function(e,t,o,n){e.$emit("title","Capabilities"),e.updateCapability=function(e){console.debug({includes:e.includes}),t("/api/v2/capabilities/"+e.id,{method:"PUT",data:{includes:e.includes}}).then(t.getHealth,t.getHealth)},e.deleteCapability=function(o){e.confirm(event,{title:"Delete Capability",message:"Are you sure you want to delete "+o.name+" capability?",yesCallback:function(){t("/api/v2/capabilities/"+o.id,{method:"DELETE"}).then(function(){t.toast("Deleted "+o.name+" capability"),t.getHealth()},function(e){t.toast("Error Deleted Capability","capability",e.data)})}})},e.rawCapabilities=function(t){var o=[];for(var n in e._capabilities)t.includes(e._capabilities[n].name)||o.push(e._capabilities[n].name);return o},e.createCapabilityPrompt=function(e){n.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addcapabilitydialog.tmpl.html",parent:angular.element(document.body),targetEvent:e,locals:{editing:!1},clickOutsideToClose:!0,fullscreen:!1})}}]).filter("groupsonly",function(){return function(e){var t=[];for(var o in e)"dr-groups"===e[o].source|"user-defined"===e[o].source&&t.push(e[o]);return t}})}()}),require.register("js/deployment_roles.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("DeploymentRolesCtrl",["$scope","$location","debounce","$routeParams","$mdMedia","$mdDialog","$timeout","api",function(e,t,o,n,r,a,i,s){function l(){e.editing||(e.deployment_role=e._deployment_roles[e.id],e.deployment_role?(e.hasAttrib===-1&&s("/api/v2/deployment_roles/"+e.deployment_role.id+"/attribs").then(function(t){var o=t.data;e.attribs=o,o.forEach(function(e){e.len=JSON.stringify(e.value).length,e.preview=JSON.stringify(e.value,null,"  ").trim().replace(/[\s\n]/g,""),e.preview.length>73&&(e.preview=e.preview.substr(0,67)+"...")}),e.hasAttrib=1},function(){e.hasAttrib=0}),c||(c=!0,e.$on("deployment_role"+e.deployment_role.id+"Done",l))):t.path("/deployment_roles"))}e.$emit("title","Deployment Roles");var d=this;e.myOrder="id",this.selected=[],e.getDeploymentRoles=function(){var t=[];for(var o in e._deployment_roles)t.push(e._deployment_roles[o]);return t},e.propose=function(){e.deployment_role.id&&s("/api/v2/deployment_roles/"+e.deployment_role.id+"/propose",{method:"PUT"}).then(function(){e.deployment_role.proposed=!0,s.addDeploymentRole},function(e){s.toast("Error Proposing Deployment Role","deployment_role",e.data)})},e.commit=function(){e.deployment_role.id&&s("/api/v2/deployment_roles/"+e.deployment_role.id+"/commit",{method:"PUT"}).then(function(){e.deployment_role.proposed=!1,s.addDeploymentRole},function(e){s.toast("Error Committing Deployment Role","deployment_role",e.data)})},e.destroySelected=function(){e.confirm(event,{title:"Destroy Deployment Roles",message:"Are you sure you want to destroy the selected deployment roles?",yesCallback:function(){d.selected.forEach(function(e){e.id&&s("/api/v2/deployment_roles/"+e.id,{method:"DELETE"}).then(function(){s.remove("deployment_role",e.id)}),d.selected=[]})}})},e.destroy=function(){e.confirm(event,{title:"Destroy Deployment Role",message:"Are you sure you want to destroy this deployment role?",yesCallback:function(){e.deployment_role.id&&s("/api/v2/deployment_roles/"+e.deployment_role.id,{method:"DELETE"}).then(function(){s.remove("deployment_role",e.deployment_role.id),t.path("/deployment_roles")})}})},e.id=n.id,e.target={obj:"deployment_role_id",id:n.id},e.deployment_role={},e.hasAttrib=-1,e.attribs=[],e.editing=!1;var c=!1;Object.keys(e._deployment_roles).length?l():e.$on("deployment_rolesDone",l),e.getApiUpdate=function(){!e.editing&&e.node_role&&s.fetch("node_role",e.id).then(function(){e.updateInterval=i(e.getApiUpdate,2e3)})},e.getApiUpdate(),e.$on("$routeChangeStart",function(){i.cancel(e.updateInterval)})}])}()}),require.register("js/deployments.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("DeploymentsCtrl",["$mdMedia","$mdDialog","$scope","$http","debounce","$timeout","$routeParams","api",function(e,t,o,n,r,a,i,s){o.$emit("title","Deployments");var l=this;this.showNodeDialog=function(n,r){o.node=r;var a=e("sm")||e("xs");t.show({controller:"DialogController",controllerAs:"ctrl",templateUrl:"nodedialog.tmpl.html",parent:angular.element(document.body),targetEvent:n,locals:{node:o.node},clickOutsideToClose:!0,fullscreen:a})},o.rawProfiles=function(e){var t=[];for(var n in o._profiles)e.includes(o._profiles[n].name)||t.push(o._profiles[n].name);return t},o.showAddNodeDialog=function(n,r){var a=e("sm")||e("xs"),i=[],s=void 0;for(var l in o._providers)i.push(o._providers[l]),"metal"!==o._providers[l].name&&"phantom"!==o._providers[l].name&&"undefined"==typeof s&&(s=l);t.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addnodedialog.tmpl.html",parent:angular.element(document.body),targetEvent:n,locals:{base_name:"digital-rebar-node",_providers:i,provider:s,hasProvider:i.length>0,_profiles:o.rawProfiles([]),profiles:[],add_os:"default_os",number:1,_deployments:o._deployments,deployment_id:r},clickOutsideToClose:!0,fullscreen:a})},o.expand={},i.id&&(o.expand[i.id]=!0),this.toggleExpand=function(e){o.expand[e.id]=!o.expand[e.id]},o.matrix={},this.getMatrixData=function(){Object.keys(o._deployments).forEach(function(e){var t=o.matrix[e]=o.matrix[e]||{loading:!0,services:[],deployment_roles:[],nodes:{}};s("/api/status/matrix/"+e).then(function(n){t.loading=!1,t.error=!1,angular.extend(o.matrix[e],n.data)},function(){t.loading=!1,t.error=!0})})},o.getNodeIds=function(e){var t=[];for(var n in o._nodes){var r=o._nodes[n];r.deployment_id!==e||r.system||t.push(n)}return t.sort(function(e,t){return o._nodes[e].name.localeCompare(o._nodes[t].name)}),t},o.assignDeploymentToTenant=function(e,t){s("/api/v2/deployments/"+e,{method:"PUT",data:{tenant_id:t}}).then(function(e){s.addDeployment(e.data)})},o.getDeploymentRoleIds=function(e){var t=[];for(var n in o._deployment_roles){var r=o._deployment_roles[n];r.deployment_id===e&&t.push(n)}return t.sort(function(e,t){var n=0,r=0;if("undefined"!=typeof e){var a=o._deployment_roles[e];if("undefined"!=typeof a){var i=o._roles[a.role_id];"undefined"!=typeof i&&(n=i.cohort)}}if("undefined"!=typeof t){var s=o._deployment_roles[t];if("undefined"!=typeof s){var l=o._roles[s.role_id];"undefined"!=typeof l&&(r=l.cohort)}}return n-r}),t},o.getNodeRoleIds=function(e){if("undefined"==typeof o.phantoms[e])return[];var t=[];for(var n in o._node_roles){var r=o._node_roles[n];r.node_id===o.phantoms[e].id&&t.push(n)}return t.sort(function(e,t){var n=0,r=0;if("undefined"!=typeof e){var a=o._node_roles[e];if("undefined"!=typeof a){var i=o._roles[a.role_id];"undefined"!=typeof i&&(n=i.cohort)}}if("undefined"!=typeof t){var s=o._node_roles[t];if("undefined"!=typeof s){var l=o._roles[s.role_id];"undefined"!=typeof l&&(r=l.cohort)}}return n-r}),t},this.getNodeCounts=function(e){var t=[0,0,0,0];for(var n in o._nodes){var r=o._nodes[n];r.deployment_id!==e.id||r.system||t[r.simpleState]++}return t},this.opts={sliceColors:["#8BC34A","#F44336","#03A9F4","#616161"],tooltipFormat:"{{value}}",disableTooltips:!0,disableHighlight:!0,borderWidth:2,borderColor:"#fff",fillColor:"#fff",width:"2em",height:"2em"},this.deploymentStatus={},o.deploymentStates={"-1":"error",0:"reserved",1:"todo",2:"ready"},o.deploymentStateNames={"-1":"error",0:"proposed",1:"committed",2:"active"},o.deploymentIcons={error:"warning",reserved:"playlist_add",todo:"playlist_play",ready:"playlist_add_check"},this.createStatusBarData=function(){o.$evalAsync(function(){for(var e in o._deployments){o.binding[e]||(o.binding[e]=!1),l.deploymentStatus[e]={error:0,total:0};for(var t in o._node_roles){var n=o._node_roles[t];if(n.deployment_id===e){var r=n.state;r===-1&&l.deploymentStatus[e].error++,l.deploymentStatus[e].total++}}}})},o.renameDeployment=function(e,n){t.show({templateUrl:"views/dialogs/editdeploymentdialog.tmpl.html",parent:angular.element(document.body),targetEvent:e,controller:["locals","$mdDialog","$scope",function(e,t,o){o.id=e.id,o.name=e.name,o.description=e.description,o.cancel=t.cancel,o.hide=t.hide}],locals:{id:n,name:o._deployments[n].name,description:o._deployments[n].description},clickOutsideToClose:!0,fullscreen:!1}).then(function(e){s("/api/v2/deployments/"+e.id,{
method:"PUT",data:{name:e.name,description:e.description}}).then(function(e){s.addDeployment(e.data)},function(e){s.toast("Couldn't Create Deployment","deployment",e.data)})})},o.redeployDeployment=function(e,t){o.confirm(e,{title:"Redeploy All Nodes in Deployment",message:"Are you sure you want to redeploy "+o._deployments[t].name+"?",yesCallback:function(){s("/api/v2/deployments/"+t+"/redeploy",{method:"PUT"}).then(function(){o.updateMatrix(o._deployments[t])},function(e){s.toast("Error Redeploying Deployment","deployment",e.data)})}})},o.deleteDeployment=function(e,t){o.confirm(e,{title:"Delete Deployment",message:"Are you sure you want to delete deployment "+o._deployments[t].name+"?",yesCallback:function(){s("/api/v2/deployments/"+t,{method:"DELETE"}).then(function(){s.remove("deployment",t)},function(e){s.toast("Error Deleting Deployment","deployment",e.data)})}})},o.proposeDeployment=function(e){"system"===o._deployments[e].name?o.confirm(event,{title:"WARNING: Proposing System Deployment",message:"Proposing the System Deployment may pause core functions. Continue?",yesCallback:function(){o.proposeDeploymentNoCheck(e)}}):o.proposeDeploymentNoCheck(e)},o.proposeDeploymentNoCheck=function(e){s("/api/v2/deployments/"+e+"/propose",{method:"PUT"}).then(function(e){s.addDeployment(e.data)},function(t){s.toast("Error Proposing Deployment "+o._deployments[e].name,"deployment",t.data)})},o.commitDeployment=function(e){s("/api/v2/deployments/"+e+"/commit",{method:"PUT"}).then(function(e){s.addDeployment(e.data)},function(t){s.toast("Error Committing Deployment "+o._deployments[e].name,"deployment",t.data)})},o.getRoles=function(e){var t=[],n=[];for(var r in o._deployment_roles){var a=o._deployment_roles[r];a.deployment_id===e&&n.push(a.role_id+"")}for(var i in o._roles)n.indexOf(i)===-1&&t.push(o._roles[i]);return t},o.addRole=function(e,t){s("/api/v2/deployment_roles/",{method:"POST",data:{deployment_id:t,add_role:{role_id:e}}}).then(function(e){s.addDeploymentRole(e.data)},function(e){s.toast("Error Adding Deployment Role","deployment_role",e.data)})},o.createDeploymentPrompt=function(e){var o=t.prompt().title("Create Deployment").textContent("Enter the Name of the New Deployment").placeholder("Deployment Name").targetEvent(e).ok("Create").cancel("Cancel");t.show(o).then(function(e){s("/api/v2/deployments",{method:"POST",data:{name:e}}).then(function(e){s.addDeployment(e.data),l.createPieChartData(),l.createStatusBarData()},function(e){s.toast("Couldn't Create Deployment","deployment",e.data)})})},o.setBindRole=function(e,t){o.bindRoles[e]={role_id:t,roles:{}};for(var n in o._node_roles){var r=o._node_roles[n];r.role_id===t&&r.deployment_id===e&&(o.bindRoles[e].roles[r.node_id]=r)}},o.matrixUpdateLoop=function(){l.getMatrixData(),a.cancel(o.updateInterval),o.updateInterval=a(o.matrixUpdateLoop,5e3)},o.matrixUpdateLoop(),o.$on("$destroy",function(){a.cancel(o.updateInterval)}),o.bindNodeRole=function(e,t,n){s("/api/v2/node_roles/",{method:"POST",data:{node_id:n,deployment_id:e,role_id:t}}).then(function(n){s.addNodeRole(n.data),o.setBindRole(e,t)},function(e){s.toast("Error Adding Node Role","node_role",e.data)})},o.destroyNodeRole=function(e){var t=o._node_roles[e],n=t.deployment_id,r=t.role_id;o.confirm(event,{title:"Destroy Node Role",message:"Are you sure you want to destroy this node role?",yesCallback:function(){s("/api/v2/node_roles/"+e,{method:"DELETE"}).then(function(){s.remove("node_role",e),o.setBindRole(n,r)})}})},o.bindRoles={},o.binding={},o.$on("$destroy",o.$on("node_rolesDone",l.createStatusBarData)),Object.keys(o._node_roles).length&&this.createStatusBarData()}])}()}),require.register("js/dhcp.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("DHCPCtrl",["$scope",function(e){e.$emit("title","DHCP Subnets"),e.expand={},e.optionMap={0:"Pad",1:"Subnet Mask",2:"Time Offset (deprecated)",3:"Router",4:"Time Server",5:"Name Server",6:"Domain Name Server",7:"Log Server",8:"Quote Server",9:"LPR Server",10:"Impress Server",11:"Resource Location Server",12:"Host Name",13:"Boot File Size",14:"Merit Dump File",15:"Domain Name",16:"Swap Server",17:"Root Path",18:"Extensions Path",19:"IP Forwarding enable/disable",20:"Non-local Source Routing enable/disable",21:"Policy Filter",22:"Maximum Datagram Reassembly Size",23:"Default IP Time-to-live",24:"Path MTU Aging Timeout",25:"Path MTU Plateau Table",26:"Interface MTU",27:"All Subnets are Local",28:"Broadcast Address",29:"Perform Mask Discovery",30:"Mask supplier",31:"Perform router discovery",32:"Router solicitation address",33:"Static routing table",34:"Trailer encapsulation",35:"ARP cache timeout",36:"Ethernet encapsulation",37:"Default TCP TTL",38:"TCP keepalive interval",39:"TCP keepalive garbage",40:"Network Information Service Domain",41:"Network Information Servers",42:"NTP servers",43:"Vendor specific information",44:"NetBIOS over TCP/IP name server",45:"NetBIOS over TCP/IP Datagram Distribution Server",46:"NetBIOS over TCP/IP Node Type",47:"NetBIOS over TCP/IP Scope",48:"X Window System Font Server",49:"X Window System Display Manager",50:"Requested IP Address",51:"IP address lease time",52:"Option overload",53:"DHCP message type",54:"Server identifier",55:"Parameter request list",56:"Message",57:"Maximum DHCP message size",58:"Renew time value",59:"Rebinding time value",60:"Class-identifier",61:"Client-identifier",62:"to 255  NetWare/IP Domain Name",63:"NetWare/IP information",64:"Network Information Service+ Domain",65:"Network Information Service+ Servers",66:"TFTP server name",67:"Bootfile name",68:"Mobile IP Home Agent",69:"Simple Mail Transport Protocol Server",70:"Post Office Protocol Server",71:"Network News Transport Protocol Server",72:"Default World Wide Web Server",73:"Default Finger Server",74:"Default Internet Relay Chat Server",75:"StreetTalk Server",76:"StreetTalk Directory Assistance Server",77:"User Class Information",78:"SLP Directory Agent",80:"Rapid Commit",81:"FQDN, Fully Qualified Domain Name",82:"Relay Agent Information",83:"Internet Storage Name Service",85:"NDS servers",86:"NDS tree name",87:"NDS context",88:"BCMCS Controller Domain Name list",89:"BCMCS Controller IPv4 address list",90:"Authentication",91:"client-last-transaction-time",92:"associated-ip",93:"Client System Architecture Type",94:"Client Network Interface Identifier",95:"LDAP, Lightweight Directory Access Protocol",97:"Client Machine Identifier",98:"Open Group's User Authentication",99:"GEOCONF_CIVIC",100:"IEEE 1003.1 TZ String",101:"Reference to the TZ Database",112:"NetInfo Parent Server Address",113:"NetInfo Parent Server Tag",114:"URL",116:"Auto-Configure",117:"Name Service Search",118:"Subnet Selection",119:"DNS domain search list",120:"SIP Servers DHCP Option",121:"Classless Static Route Option",122:"CCC, CableLabs Client Configuration",123:"GeoConf",124:"Vendor-Identifying Vendor Class",125:"Vendor-Identifying Vendor-Specific",128:"TFTP Server IP address",129:"Call Server IP address",130:"Discrimination string",131:"Remote statistics server IP address",132:"802.1P VLAN ID",133:"802.1Q L2 Priority",134:"Diffserv Code Point",135:"HTTP Proxy for phone-specific applications",136:"PANA Authentication Agent",137:"LoST Server",138:"CAPWAP Access Controller addresses",139:"OPTION-IPv4_Address-MoS",140:"OPTION-IPv4_FQDN-MoS",141:"SIP UA Configuration Service Domains",142:"OPTION-IPv4_Address-ANDSF",143:"OPTION-IPv6_Address-ANDSF",150:"TFTP server address / Etherboot GRUB configuration path name",151:"status-code",152:"base-time",153:"start-time-of-state",154:"query-start-time",155:"query-end-time",156:"dhcp-state",157:"data-source",175:"Etherboot",176:"IP Telephone",177:"Etherboot. PacketCable and CableHome",208:"pxelinux.magic (string) = F1:00:74:7E (241.0.116.126)",209:"pxelinux.configfile (text)",210:"pxelinux.pathprefix (text)",211:"pxelinux.reboottime (unsigned integer 32 bits)",212:"OPTION_6RD",213:"OPTION_V4_ACCESS_DOMAIN",220:"Subnet Allocation",221:"Virtual Subnet Selection",254:"Private use",255:"End."}}])}()}),require.register("js/dialog.js",function(e,t,o){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){angular.module("app").controller("DialogController",["$scope","$rootScope","$mdDialog","locals","api","$mdToast","debounce","$location","localStorageService",function(e,t,o,r,a,i,s,l,d){e.locals=r,r.api=a,e.icons=t.icons,e.fixCaps=function(e){var t=r.user.caps[e.id].caps;for(var o in t){var a=t[o];"object"===("undefined"==typeof a?"undefined":n(a))&&(t[o]=a.id)}r.user.caps[e.id].caps=t.reduce(function(e,t){return e.includes(t)||e.push(t),e},[])},e.providers=function(){var e=[];for(var t in r._providers){var o=r._providers[t];Object.keys(o.auth_details).length&&e.push(o)}return e}(),e.loadProvider=function(e){return function(t){t.setValue(JSON.stringify(r.provider.auth_details[e],0,"  "),-1),t.getSession().on("change",function(){try{r.provider.auth_details[e]=JSON.parse(t.getValue())}catch(o){}})}},e.loadBarclamp=function(e){e.setValue(JSON.stringify(r.barclamp.cfg_data,0,"  "),-1),e.getSession().on("change",function(){try{r.barclamp.cfg_data=JSON.parse(e.getValue())}catch(t){}})},e.providerMap=function(){var e={};for(var t in r._providers){var o=r._providers[t];e[o.name]=o,"MetalProvider"!==o.type&&""!==o.type}return e}(),e.hide=function(){o.hide()},e.cancel=function(){o.cancel()},e.parse=function(e,t){try{var o=JSON.parse(e);return t?"undefined"!=typeof o:o}catch(n){return!1}},this.updateBarclamp=function(){var t=e.locals.barclamp.cfg_data;return t?t.barclamp.name?(a.saveBarclamp(t),void o.hide()):void a.toast("Name is required","barclamp",{message:"dialog.js updateBarclamp"}):void a.toast("Bad JSON","barclamp",{message:"dialog.js updateBarclamp"})},this.updateNode=function(){var e={name:r.name1,description:r.description1,profiles:r.profiles1};a("/api/v2/nodes/"+r.id,{method:"PUT",data:e}).then(function(e){a.toast("Updated Node "+r.node.name),a.addNode(e.data),o.hide()},function(e){a.toast("Error Updating Node","node",e.data)})},this.editNodesInHelper=function(){var n=r.providers[r.provider].name,a=e.providerMap[n].auth_details["provider-create-hint"];if(null===a){var i=e.providerMap[n].type;a=t.providerTemplates[i]["provider-create-hint"]["default"]}var s={name:r.base_name+"."+n+".neode.org",description:"created by rebar",provider:n,profiles:r.profiles,deployment_id:r.deployment_id,hints:{"use-proxy":!1,"use-ntp":!1,"use-dns":!1,"use-logging":!1,"provider-create-hint":a}};s.hints["provider-create-hint"].hostname=r.base_name,d.add("api_helper_payload",JSON.stringify(s,null,"  ")),d.add("api_helper_method","post"),d.add("api_helper_route","/api/v2/nodes/"),o.hide(),l.path("/api_helper")},this.addNodes=function(){var n=Array.apply(null,{length:r.number}).map(Number.call,Number),i=void 0;r.provider=parseInt(r.provider),r._providers.forEach(function(e){e.id===r.provider&&(i=e.name)});var s=e.providerMap[i].auth_details["provider-create-hint"];if(null===s){var l=e.providerMap[i].type;s=t.providerTemplates[l]["provider-create-hint"]["default"]}n.forEach(function(e){var t={name:r.base_name+"-"+e+"."+i+".neode.org",description:"created by rebar",provider:i,profiles:r.profiles,deployment_id:r.deployment_id,hints:{"use-proxy":!1,"use-ntp":!1,"use-dns":!1,"use-logging":!1,"provider-create-hint":s}};t.hints["provider-create-hint"].hostname=r.base_name+"-"+e,a("/api/v2/nodes",{method:"POST",data:t}).then(function(e){a.addNode(e.data)},function(e){a.toast("Error updating node","node",e.data)})}),a.toast("Adding "+r.number+" node"+(1!==r.number?"s":"")),o.hide()},this.addProvider=function(){a("/api/v2/providers",{method:"POST",data:r.provider}).then(function(e){a.addProvider(e.data)},function(e){a.toast("Error Adding Provider","provider",e.data)}),o.hide()},this.addNetwork=function(){r.network.name=r.network.category+"-"+r.network.group,a("/api/v2/networks",{method:"POST",data:r.network}).then(function(e){a.addNetwork(e.data)},function(e){a.toast("Error Adding Network","network",e.data)}),o.hide()},this.addDNSRecord=function(){var e=r.zone;a("/dns/zones/"+e.name,{method:"PATCH",data:r.record}).then(a.getHealth,a.getHealth),o.hide()},this.createTemplate=function(){var t=e.locals.template,n=void 0,i=void 0,s=void 0;r.editing?(n="/provisioner/templates/"+t.UUID,i="PATCH",s=[{op:"replace",path:"/Contents",value:t.Contents}]):(n="/provisioner/templates",i="POST",s=t),a(n,{method:i,data:s}).then(a.getHealth,a.getHealth),o.hide()},e.selectedFile="",e.selectFile=function(){document.getElementById("file").click()},e.updateTemplateContents=function(){var t=document.getElementById("file");e.selectedFile="";var o=t.files[0],n=new FileReader;n.onloadend=function(e){var t=e.target.result;r.template.Contents=t},n.readAsBinaryString(o),t.value=""},this.createTenant=function(){var t=e.locals.tenant,n=void 0,i=void 0,s=void 0;r.editing?(n="/api/v2/tenants/"+t.uuid,i="PATCH",s=[{op:"replace",path:"/name",value:t.name},{op:"replace",path:"/description",value:t.description},{op:"replace",path:"/parent_id",value:t.parent_id}]):(n="/tenants",i="POST",s=angular.copy(t)),a(n,{method:i,data:s}).then(function(){},function(e){a.toast("Error creating tenant","tenants",e.data)}),o.hide()},this.createCapability=function(){var t=e.locals.capability,n=void 0,i=void 0,s=void 0;r.editing?(n="/api/v2/capabilities/"+t.id,i="PATCH",s=[{op:"replace",path:"/description",value:t.description}]):(t.includes=["USER_LOGIN"],t.source="user-defined",n="/api/v2/capabilities",i="POST",s=angular.copy(t)),a(n,{method:i,data:s}).then(function(){r.editing||(a.toast("Added capability "+t.name),a.getHealth())},function(e){a.toast("Error creating capability","capabilities",e.data)}),o.hide()},this.createUser=function(){var t=e.locals.user,n=void 0,i=void 0,s=void 0;return t.password1.length<6?void a.toast("Password must be at least 6 characters","user"):t.password1!==t.password2?void a.toast("Passwords must match","user"):(t.current_tenant_id||(t.current_tenant_id=t.tenant_id),s=t,r.editing?(n="/api/v2/users/"+t.id,i="PUT",""!==t.password1&&(s.digest=!0,s.password=t.password1)):(n="/api/v2/users",i="POST",""!==t.password1&&(s.digest=!0,s.password=t.password1),s=t),a(n,{method:i,data:s}).then(a.getUsers,a.getUsers),void o.hide())},this.createBootEnv=function(){var t=e.locals.env,n=void 0,i=void 0,s=void 0;if(r.editing){n="/provisioner/bootenvs/"+t.Name,i="PATCH",s=[];var l=r.original;for(var d in t)JSON.stringify(t[d])!==JSON.stringify(l[d])&&s.push({op:"replace",path:"/"+d,value:t[d]})}else n="/provisioner/bootenvs",i="POST",s=t;a(n,{method:i,data:s}).then(a.getHealth,a.getHealth),o.hide()},this.profileSelectChanged=function(e,t,o){var a=e[t];e[o]=a,void 0!==n(r.attribs[o]["default"])&&(e[o].value=JSON.stringify(r.attribs[o]["default"].value)),t!==o&&delete e[t]},this.profileClearData=function(e,t){return delete e[t],!0},this.profileNewValue=function(e){return e["new"]={name:"new",value:""},!0},this.createProfile=function(){var t=e.locals.profile,n=void 0,i=void 0,s=void 0,l={};l.name=t.name,l.values={};for(var d in t.values)l.values[d]=JSON.parse(t.values[d].value);if(r.editing){n="/api/v2/profiles/"+l.name,i="PATCH",s=[];var c=r.original;for(var p in l)JSON.stringify(l[p])!==JSON.stringify(c[p])&&s.push({op:"replace",path:"/"+p,value:l[p]})}else n="/api/v2/profiles",i="POST",s=l;a(n,{method:i,data:s}).then(function(e){a.addProfile(e.data),a.getHealth()},a.getHealth),o.hide()},this.updateUserCaps=function(){var e=r.user,t=e.id,n=r.original,i=[],l=function(o){var r=e.caps[o].caps,a=n.caps[o].caps,s=r.filter(function(e){return a.indexOf(e)<0}),l=a.filter(function(e){return r.indexOf(e)<0});for(var d in s)i.push({method:"POST",data:{tenant_id:o,user_id:t,capability_id:s[d]}});for(var c in l)i.push({method:"DELETE",params:{tenant_id:o,user_id:t,capability_id:l[c]}})};for(var d in e.caps)l(d);for(var c in i){var p=i[c];a("/api/v2/user_tenant_capabilities",p).then(s(r.update,500,!0))}o.hide()},this.editAttrib=function(e){var n=r.id,i=void 0;try{i=JSON.parse(r.value)}catch(s){return}var l={value:i};l[e.obj]=e.id;var d="";switch(e.obj){case"node_role_id":d="/api/v2/node_roles/"+e.id+"/propose";break;case"deployment_role_id":d="/api/v2/deployment_roles/"+e.id+"/propose"}a(d,{method:"PUT"}).then(function(){a("/api/v2/attribs/"+n,{method:"PUT",data:l}).then(function(o){var n=o.data;a.toast("Updated Attrib!"),r.attrib.value=n.value,"deployment_role_id"===e.obj&&(t._deployment_roles[e.id].proposed=!0)},function(e){a.toast("Error updating attrib","attrib",e.data)})},function(t){a.toast("Error proposing target object",e.obj,t.data)}),o.hide()}}])}()}),require.register("js/dns.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("DNSCtrl",["$scope","api","$mdDialog","$mdMedia",function(e,t,o,n){e.$emit("title","DNS Zones");var r=this;this.selected=[],e.deleteRecords=function(o){e.confirm(event,{title:"Remove Records",message:"Are you sure you want to remove selected records?",yesCallback:function(){r.selected.forEach(function(e){e.changetype="REMOVE",t("/dns/zones/"+o.name,{method:"PATCH",data:e}).then(t.getHealth,t.getHealth)}),r.selected=[]}})},e.add=function(e,t){var r=n("sm")||n("xs");o.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/adddnsrecorddialog.tmpl.html",parent:angular.element(document.body),targetEvent:e,locals:{zone:t,record:{changetype:"ADD",name:"",content:"",type:""}},clickOutsideToClose:!0,fullscreen:r})}}])}()}),require.register("js/engine.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("EngineCtrl",["$scope",function(e){e.$emit("title","Rule Engine")}])}()}),require.register("js/graphs.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("GraphsCtrl",["$scope","$location","debounce","$routeParams","$mdMedia","$mdDialog","$timeout","api",function(e,t,o,n,r,a,i,s){e.$emit("title","Graphs"),e.graphData={},e.graphOptions={},e.graphType="node_roles",e.graphDeployment=0,e.graphNode=0,e.graphRole=0,e.graphBarclamp=0,e.graphHLayout=!1,e.graphLayoutOptions={hierarchical:{enabled:!0,levelSeparation:150,direction:"UD",sortMethod:"directed"}},e.getGraph=function(){e.hasGraph=-1;var t={};switch(e.graphType){case"node_roles":e.graphDeployment&&(t.deployment_id=e.graphDeployment),e.graphRole&&(t.role_id=e.graphRole),e.graphNode&&(t.node_id=e.graphNode);break;case"roles":e.graphRole&&(t.role_id=e.graphRole),e.graphBarclamp&&(t.barclamp_id=e.graphBarclamp)}e.graphDeployment&&s("/api/v2/"+e.graphType+"/graph",{data:t}).then(function(t){var o=t.data,n=vis.network.convertDot(o.string);e.graphData={nodes:n.nodes,edges:n.edges},e.graphOptions=n.options,e.graphHLayout&&(e.graphOptions.layout=e.graphLayoutOptions),e.hasGraph=1},function(t){e.hasGraph=0,s.toast("Error Getting Graph Data","node_role",t.data)})};var l=e.$watchCollection("graphHLayout",function(t){t?e.graphOptions.layout=e.graphLayoutOptions:e.graphOptions.layout={hierarchical:{enabled:!1}}});e.$on("$destroy",l),e.getGraph()}])}()}),require.register("js/helper.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("ApiHelperCtrl",["$scope","api","localStorageService",function(e,t,o){e.$emit("title","API Helper"),e.method=o.get("api_helper_method")||"get",e.payload=o.get("api_helper_payload")||"{}",e.route=o.get("api_helper_route")||"",e["class"]={},e.parse=function(t){try{var n=JSON.parse(t);return o.add("api_helper_payload",t),o.add("api_helper_method",e.method),o.add("api_helper_route",e.route),n}catch(r){return!1}};var n=e.$watchCollection("method",function(t){"patch"===t&&"{}"===e.payload&&(e.payload='[\n  {"op": "replace/add/remove", "path": "/attrName", "value": "foo" }\n]')});e.$on("$destroy",n),e.testApi=function(){t(e.route,{method:e.method,data:JSON.parse(e.payload)}).then(function(t){e["class"]={success:!0},e.output=JSON.stringify(t.data,null,"  ")},function(t){e["class"]={error:!0},e.output=JSON.stringify(t&&t.data||t,null,"  ")||t.data})},e.clearOutput=function(){e.output="",e["class"]={}}}])}()}),require.register("js/logging.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("LoggingCtrl",["$scope","api","$mdDialog","$mdMedia","localStorageService",function(e,t,o,n,r){e.$emit("title","Alert History"),e.query={page:1,limit:10},e.myOrder="-date",e.showInfo=function(e,t){o.show({template:'<md-dialog aria-label="Error">  <md-toolbar>    <div class="md-toolbar-tools">      <h2>'+t.type+" - "+t.message+'</h2>    </div>  </md-toolbar>  <md-dialog-content>    <div class="md-dialog-content">      <b>Error:&nbsp;</b>      <pre>'+JSON.stringify(t.err,null,"  ")+"</pre>      <b>Stack:</b>      <pre>"+t.stack+"</pre>    </div>  </md-dialog-content></md-dialog>",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})},e.remove=function(e){t.errors.splice(t.errors.indexOf(e),1),r.add("errors",t.errors)},e.method="get",e.payload="{}",e.route="",e["class"]={},e.parse=function(e){try{return JSON.parse(e)}catch(t){return!1}},e.testApi=function(){t(e.route,{method:e.method,data:JSON.parse(e.payload)}).then(function(t){e["class"]={success:!0},e.output=JSON.stringify(t.data,null,"  ")},function(t){e["class"]={error:!0},e.output=JSON.stringify(t&&t.data||t,null,"  ")||t.data})},e.clearOutput=function(){e.output="",e["class"]={}}}])}()}),require.register("js/login.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("LoginCtrl",["$scope","api","$location","localStorageService","$http","$cookies","debounce","$mdMedia","$mdDialog","$mdToast",function(e,t,o,n,r,a,i,s,l,d){e.$emit("title","Login"),this.credentials={username:n.get("username")||"",password:n.get("password")||""},e.acceptedEula=n.get("accept_eula")||!1,e.acceptEula=function(t){e.acceptedEula?(n.add("accept_eula",!1),e.acceptedEula=!1):l.show({controller:"LoginCtrl",templateUrl:"views/dialogs/accepteuladialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1}).then(function(t){n.add("accept_eula",t),e.acceptedEula=n.get("accept_eula")},function(){})},e.answerEula=function(e){l.hide(e)},this.hosts=n.get("hosts")||[],this.host=e.host;var c=o.search();c.host&&(this.host=c.host);var p=this;this.testHost=function(r){return r?(e.$emit("host",r),void t("/api/license").then(function(i){var s=i.data;p.state=1,e.eula=s.eula,a.put("host",p.host),e.$emit("host",r);var l=n.get("hosts")||[];l.indexOf(r)<0&&(p.hosts=l.concat(r),n.add("hosts",p.hosts));var d=a.get("DrAuthToken");"undefined"!=typeof d?t("/api/v2/users/").then(function(){var t=a.get("DrAuthUser");n.add("username",t),e.$emit("login",{username:t}),e.$emit("startUpdating"),o.path(e.lastPath)},function(){a.remove("DrAuthUser"),a.remove("DrAuthToken"),a.remove("_rebar_session")}):n.get("username")&&n.get("password")&&p.signIn()},function(){p.state=-1})):void(p.state=-1)},this.showEulaDialog=function(t,o){e.node=o;var n=s("sm")||s("xs");l.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/euladialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{host:e.host,eula:e.eula},clickOutsideToClose:!0,fullscreen:n})},e.delayTest=function(){p.state=0,e.eula=void 0,p.testHost(p.host)};var u=e.$watchCollection("login.host",e.delayTest);e.$on("$destroy",u),this.signIn=function(){return e.acceptedEula?(console.log("attempting to sign in"),n.add("username",p.credentials.username),n.add("password",p.credentials.password),void t("/api/v2/digest",{method:"HEAD",headers:{"Content-Type":"application/json"},params:{rackn:"ux v"+window.version}}).then(function(){p.getUser()},function(e){console.log("error",e),d.show(d.simple().textContent(e.status+" - "+e.statusText).position("top left").hideDelay(3e3))})):void t.toast("Please Accept the Eula")},this.getUser=function(){t("/api/v2/digest",{method:"GET"}).then(function(t){e.$emit("login",t.data),e.$emit("startUpdating"),o.path(e.lastPath)})}}])}()}),require.register("js/networks.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("NetworksCtrl",["$scope","api","$mdDialog","$mdMedia","$routeParams","$location",function(e,t,o,n,r,a){function i(){e.editing||(e.network=e._networks[e.id],e.network?(e.hasRanges===-1&&t("/api/v2/networks/"+e.network.id+"/network_ranges").then(function(t){var o=t.data;o.forEach(function(t){e._ranges[t.id]=t}),e.ranges=angular.copy(e._ranges),e.hasRanges=1},function(){e.hasRanges=0}),e.hasRouter===-1&&t("/api/v2/network_routers/"+e.network.id).then(function(t){var o=t.data;e._router=o,e.router=angular.copy(e._router),e.hasRouter=1},function(){e._router={address:"0.0.0.0/32",pref:"65536",add_router:!0},e.router={address:"Not Set",pref:"Not Set"},e.hasRouter=1}),l||(l=!0,e.$on("network"+e.network.id+"Done",i))):a.path("/networks"))}e.$emit("title","Networks"),e.myOrder="name";var s=this;this.selected=[],this.order="name",this.getNetworks=function(){var t=[];for(var o in e._networks)t.push(e._networks[o]);return t},this.deleteSelected=function(o){e.confirm(o,{title:"Remove Networks",message:"Are you sure you want to remove selected networks?",yesCallback:function(){s.selected.forEach(function(e){t("/api/v2/networks/"+e.id,{method:"DELETE"}).then(function(){console.log("network deleted")}).then(function(){t.remove("network",e.id)})}),s.selected=[]}})},this.showAddNetworkDialog=function(t){var r=n("sm")||n("xs");o.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addnetworkdialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{network:{name:"",description:"",category:"general",group:"default",deployment_id:1,v6prefix:"auto",use_vlan:!1,use_bridge:!1,use_team:!1,vlan:null,bridge:null,team_mode:null,conduit:"10g1",pbr:null},_deployments:e._deployments},clickOutsideToClose:!0,fullscreen:r})},e.assignNetworks=function(e,o){e.forEach(function(e){t("/api/v2/networks/"+e.id,{method:"PUT",data:{deployment_id:o}}).then(function(e){t.addNetwork(e.data)})})},e.assignNetworksToTenant=function(e,o){e.forEach(function(e){t("/api/v2/networks/"+e.id,{method:"PUT",data:{tenant_id:o}}).then(function(e){t.addNetwork(e.data)})})},e["delete"]=function(o){e.confirm(o,{title:"Remove Network",message:"Are you sure you want to remove this network?",yesCallback:function(){t("/api/v2/networks/"+e.id,{method:"DELETE"}).then(function(){console.log("network deleted")}).then(function(){t.remove("network",e.id),a.path("/networks")})}})},e.saveNetwork=function(){if(e.editing){var o=angular.copy(e.network);o.use_vlan||delete o.vlan,o.use_bridge||delete o.bridge,o.use_team||delete o.team_mode,t("/api/v2/networks/"+e.id,{method:"PUT",data:o}).then(function(e){t.addNetwork(e.data)},function(e){t.toast("Couldn't Save Network","networks",e.data)}),e.stopEditing()}},e.stopEditing=function(){e.editing&&(e.network=e._networks[e.id],e.editing=!1)},e.startEditing=function(){e.editing||(e.editing=!0,e.network=angular.copy(e._networks[e.id]))},e.saveNetworkRanges=function(){if(e.editingRanges){var o=angular.copy(e.ranges);Object.keys(o).forEach(function(n){var r=o[n],a=e._ranges[n];JSON.stringify(r)!==JSON.stringify(a)&&t("/api/v2/network_ranges/"+r.id,{method:"PUT",data:r}).then(function(t){var o=t.data;e._ranges[o.id]=o,e.ranges[o.id]=angular.copy(o)},function(e){t.toast("Couldn't Save Network Range","network_ranges",e.data)})}),e.stopEditingRanges()}},e.deleteRange=function(o){e.confirm(event,{title:"Remove Network Range",message:"Are you sure you want to remove network range "+e._ranges[o].name+"?",yesCallback:function(){t("/api/v2/networks/"+e.id+"/network_ranges/"+o,{method:"DELETE"}).then(function(){delete e._ranges[o],delete e.ranges[o]})}})},e.addRange=function(){t("/api/v2/networks/"+e.id+"/network_ranges/",{method:"POST",data:{network_id:e.id,name:"Default",first:"10.10.10.1/24",last:"10.10.10.254/24"}}).then(function(t){var o=t.data;e._ranges[o.id]=o,e.ranges[o.id]=angular.copy(o)},function(e){t.toast("Couldn't Add Network Range","network_ranges",e.data)})},e.stopEditingRanges=function(){e.editingRanges&&(e.ranges=e._ranges,e.editingRanges=!1)},e.startEditingRanges=function(){e.editingRanges||(e.editingRanges=!0,e.ranges=angular.copy(e._ranges))},e.saveNetworkRouter=function(){if(e.editingRouter){var o=angular.copy(e.router),n="/api/v2/network_routers/"+e.id,r="PUT";o.add_router&&(n="/api/v2/networks/"+e.id+"/network_routers",r="POST"),t(n,{method:r,data:o}).then(function(t){var o=t.data;e._router=o,e.router=angular.copy(o)},function(e){t.toast("Couldn't Save Network Router","network_routers",e.data)}),e.stopEditingRouter()}},e.stopEditingRouter=function(){e.editingRouter&&(e.router=e._router,e.editingRouter=!1)},e.startEditingRouter=function(){e.editingRouter||(e.editingRouter=!0,e.router=angular.copy(e._router))},e.id=r.id,e.network={},e.editing=!1,e.hasRanges=-1,e.ranges={},e._ranges={},e.editingRanges=!1,e.hasRouter=-1,e.router={},e._router={},e.editingRouter=!1;var l=!1;Object.keys(e._networks).length?i():e.$on("networksDone",function(){"undefined"==typeof e._networks[e.id]?a.path("/networks"):i()})}])}()}),require.register("js/node_roles.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("NodeRolesCtrl",["$scope","$location","debounce","$routeParams","$mdMedia","$mdDialog","$timeout","localStorageService","api",function(e,t,o,n,r,a,i,s,l){function d(){if(!e.editing)if(e._node_roles[e.id]){e.node_role=e._node_roles[e.id],e.service=!!e._nodes[e.node_role.node_id]&&e._nodes[e.node_role.node_id].system;for(var o in e._deployment_roles){var n=e._deployment_roles[o];if(n.role_id===e.node_role.role_id&&n.deployment_id===e.node_role.deployment_id){e.deployment_role_id=o;break}}e.hasAttrib===-1&&l("/api/v2/node_roles/"+e.node_role.id+"/attribs").then(function(t){var o=t.data;e.attribs=o,o.forEach(function(e){e.len=JSON.stringify(e.value).length,e.preview=JSON.stringify(e.value,null,"  ").trim().replace(/[\s\n]/g,""),e.preview.length>73&&(e.preview=e.preview.substr(0,67)+"...")}),e.hasAttrib=1},function(){e.hasAttrib=0}),u||(u=!0,e.$on("node_role"+e.node_role.id+"Done",d))}else t.path("/node_roles")}e.$emit("title","Node Roles"),e.query={page:1,limit:10};var c=this;e.pollLog=5,e.myOrder="id",e.style={},e.top=0,e.updateScroll=function(){if(e.id&&$("#runlog").position()){var t=$("#runlog").position().top-$("#runlog").height();e.top=t;var o=$(".md-default:not(#runlog)");t<0?(e.style={position:"fixed"},o.css("width",$("#runlog").width()),o.css("top",$("#toolbar").height())):(e.style={},o.css("width","auto"),o.css("top","auto"))}};var p=e.$watchCollection("scroll",e.updateScroll);e.$on("$destroy",p),this.selected=[],e.editAttribInHelper=function(e){s.add("api_helper_method","get"),s.add("api_helper_route","/api/v2/attribs/"+e),t.path("/api_helper")},e.getNodeRoles=function(){var t=[];for(var o in e._node_roles){var n=e._nodes[e._node_roles[o].node_id];n&&"phantom"!==n.variant&&t.push(e._node_roles[o])}return t},e.retry=function(){e.runlog="Retrying...",e.node_role.id&&l("/api/v2/node_roles/"+e.node_role.id+"/retry",{method:"PUT"}).then(function(t){l.addNodeRole(t.data),e.updateScroll()},function(e){l.toast("Error retrying node role","node_role",e.data)})},e.commit=function(){e.node_role.id&&l("/api/v2/node_roles/"+e.node_role.id+"/commit",{method:"PUT"}).then(function(t){l.addNodeRole(t.data),e.updateScroll()},function(e){l.toast("Error committing node role","node_role",e.data)})},e.destroySelected=function(){e.confirm(event,{title:"Destroy Node Roles",message:"Are you sure you want to destroy the selected node roles?",yesCallback:function(){c.selected.forEach(function(e){e.id&&l("/api/v2/node_roles/"+e.id,{method:"DELETE"}).then(function(){l.remove("node_role",e.id)}),c.selected=[]})}})},e.retrySelected=function(e){var t=c.selected;e&&(t=e),t.forEach(function(t){t.id&&l("/api/v2/node_roles/"+t.id+"/retry",{method:"PUT"}),e||(c.selected=[]);
})},e.destroy=function(){e.confirm(event,{title:"Destroy Node Role",message:"Are you sure you want to destroy this node role?",yesCallback:function(){e.node_role.id&&l("/api/v2/node_roles/"+e.node_role.id,{method:"DELETE"}).then(function(){l.remove("node_role",e.node_role.id),t.path("/node_roles")})}})},e.supported=!1,e.onCopy=function(e){e?l.toast("Copied Runlog to Clipboard"):l.toast("Copy Runlog to Clipboard Failed")},e.id=n.id,e.target={obj:"node_role_id",id:n.id},e.node_role={},e.hasAttrib=-1,e.attribs=[],e.editing=!1,e.service=!1,e.deployment_role_id=-1,e.helplink="http://digital-rebar.readthedocs.io/en/latest/deployment/troubleshooting/roles";var u=!1;e.runlog="Retrieving...",e.getRunlog=function(t){return l("/api/v2/node_roles/"+t,{headers:{"x-return-attributes":'["runlog"]'}}).then(function(t){e.runlog=t.data.runlog||"No Log"},function(t){e.runlog="Error Getting Run Log: "+t.data})},Object.keys(e._node_roles).length?d():e.$on("node_rolesDone",d),e.getApiUpdate=function(){!e.editing&&e.node_role&&e.id&&l("/api/v2/node_roles/"+e.id).then(function(t){e.runlog=t.data.runlog,l.addNodeRole(t.data),e.updateInterval=i(e.getApiUpdate,1e3*e.pollLog)})},e.changeRate=function(t){e.pollLog=t,i.cancel(e.updateInterval),e.getApiUpdate()},e.getApiUpdate(),e.$on("$routeChangeStart",function(){i.cancel(e.updateInterval)})}])}()}),require.register("js/nodes.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("NodesCtrl",["$scope","$location","debounce","$routeParams","$mdMedia","$mdDialog","api",function(e,t,o,n,r,a,i){function s(){e.editing||(e.node=e._nodes[e.id],e.node?(i("/api/v2/nodes/"+e.node.id+"/power").then(function(t){var o=t.data;for(var n in o)["status","on?"].includes(o[n])&&o.splice(n,1);e.power=o}),i("/api/v2/nodes/"+e.node.id+"/network_allocations").then(function(t){var o=t.data;e.nics={};for(var n in o)e.nics[o[n].network_id]||(e.nics[o[n].network_id]=[]),e.nics[o[n].network_id].push(o[n])}),e.hasAttrib===-1&&i("/api/v2/nodes/"+e.node.id+"/attribs").then(function(t){var o=t.data;e.attribs=o,o.forEach(function(t){var o=JSON.stringify(t.value);t.len=o.length,t.preview=JSON.stringify(t.value,null,"  ").trim().replace(/[\s\n]/g,""),"undefined"==typeof t.value&&(t.value="Not Set"),t.preview.length>73&&(t.preview=t.preview.substr(0,67)+"..."),"ipmi-address"===t.name&&(e.bmc=t.value),"chassis_serial_number"===t.name&&(e.serial=t.value)}),e.hasAttrib=1},function(){e.hasAttrib=0}),c||(c=!0,e.$on("node"+e.node.id+"Done",s))):t.path("/nodes"))}e.$emit("title","Nodes"),e.query={page:1,limit:10},e.myOrder="name";var l=this;this.nodes=[],this.selected=[],e.move_tenant=!0,e.restructureRoles=function(t){return{order:t.cohort,status:t.status,name:e._roles[t.role_id].name,icon:e._roles[t.role_id].icon,id:t.id}},this.getNodes=function(){var t=[];for(var o in e._nodes){var n=angular.copy(e._nodes[o]),r=n.provider_id,a=n.deployment_id;if(!e._nodes[o].system){"undefined"!=typeof e._providers[r]&&(n.provider_name=e._providers[r].name),"undefined"!=typeof e._deployments[a]&&(n.deployment_name=e._deployments[a].name);var i=e._tenants[n.tenant_id];"undefined"!=typeof i&&(n.tenant_name=i.name,n.tenant_uuid=i.uuid),t.push(n)}}l.nodes=t};var d=[e.$parent.$watchCollection("_deployments",l.getNodes),e.$parent.$watchCollection("_providers",l.getNodes),e.$parent.$watchCollection("_nodes",l.getNodes),e.$parent.$watchCollection("_tenants",l.getNodes)];e.$on("$destroy",function(){return d.map(function(e){return e()})}),this.deleteSelected=function(t){e.confirm(t,{title:"Delete Nodes",message:"Are you sure you want to delete selected nodes?",yesCallback:function(){l.selected.forEach(function(e){return e.admin?void console.log("Can't delete admin node !"+e.id):(console.log("Deleting node "+e.id),void i("/api/v2/nodes/"+e.id,{method:"DELETE"}).then(function(){console.log("Node deleted")}).then(function(){i.remove("node",e.id)}))}),l.selected=[]}})},this.deleteNode=function(o){e.confirm(o,{title:"Delete Node",message:"Are you sure you want to delete "+e.node.name,yesCallback:function(){return e.node.admin?(console.log("Can't delete admin node!"),void i.toast("Cannot delete admin node")):(console.log("Deleting node "+e.node.id),void i("/api/v2/nodes/"+e.node.id,{method:"DELETE"}).then(function(){console.log("Node deleted"),i.remove("node",e.node.id),t.path("/nodes")}))}})},e.rawProfiles=function(t){var o=[];for(var n in e._profiles)t.includes(e._profiles[n].name)||o.push(e._profiles[n].name);return o},this.showAddNodeDialog=function(t){var o=r("sm")||r("xs"),n=[],i=void 0;for(var s in e._providers)n.push(e._providers[s]),"metal"!==e._providers[s].name&&"phantom"!==e._providers[s].name&&"undefined"==typeof i&&(i=s);a.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addnodedialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{base_name:"digital-rebar-node",_providers:n,provider:i,hasProvider:n.length>0,_profiles:e.rawProfiles([]),profiles:[],add_os:"default_os",number:1,_deployments:e._deployments},clickOutsideToClose:!0,fullscreen:o})},this.showEditNodeDialog=function(t,o){var n=r("sm")||r("xs");a.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/editnodedialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{_profiles:e.rawProfiles(o.profiles),node:o,name1:o.name,description1:o.description,profiles1:o.profiles,id:o.id},clickOutsideToClose:!0,fullscreen:n})},e.assignNodes=function(t,o,n){t.forEach(function(t){var r={node_deployment:{deployment_id:o,old_deployment:t.deployment_id}};n&&(r.tenant_id=e._deployments[o].tenant_id),i("/api/v2/nodes/"+t.id,{method:"PUT",data:r}).then(function(e){i.addNode(e.data)})})},e.assignNodesToTenant=function(e,t){e.forEach(function(e){i("/api/v2/nodes/"+e.id,{method:"PUT",data:{tenant_id:t}}).then(function(e){i.addNode(e.data)})})},e.getRoles=function(){var t=[],o=e.node.deployment_id;for(var n in e._deployment_roles){var r=e._deployment_roles[n];r.deployment_id===o&&t.push(r)}return t},e.bindNodeRole=function(t){var o=e.node.id,n=e.deployment_id;i("/api/v2/node_roles/",{method:"POST",data:{node_id:o,deployment_id:n,role_id:t}}).then(function(e){i.addNodeRole(e.data)},function(e){i.toast("Error Adding Node Role","node_role",e.data)})},e.setPower=function(t){e.confirm(event,{title:"Redeploy Node",message:"Are you sure you want to set power to "+t+"?",yesCallback:function(){e.node.id&&i("/api/v2/nodes/"+e.node.id+"/power",{data:{poweraction:t},method:"PUT"}).then(function(e){i.addNode(e.data)},function(e){i.toast("Error Powering Node","node",e.data)})}})},e.redeploy=function(t){e.confirm(event,{title:"Redeploy Node",message:"Are you sure you want to redeploy this node?",yesCallback:function(){e.redeploy_target(e.node.id,t)}})},e.redeploy_target=function(e,t){i("/api/v2/nodes/"+e+"/propose",{method:"PUT"}).then(function(){t?i("/api/v2/nodes/"+e+"/attribs/provisioner-target_os",{method:"GET"}).then(function(o){var n=o.data;i("/api/v2/attribs/"+n.id,{method:"PUT",data:{node_id:n.node_id,role_id:n.role_id,value:t}}).then(function(){i("/api/v2/nodes/"+e+"/redeploy",{method:"PUT"}).then(function(){i.toast("Redeployed node "+e)},function(e){i.toast("Error Redeploying Node","node",e.data)})})}):i("/api/v2/nodes/"+e+"/redeploy",{method:"PUT"}).then(function(){i.toast("Redeployed node "+e)},function(e){i.toast("Error Redeploying Node","node",e.data)})})},e.reserve=function(t){e.node.id&&i("/api/v2/nodes/"+e.node.id,{method:"PUT",data:{available:!t}}).then(function(e){i.addNode(e.data)},function(e){i.toast("Error Reserving","node",e.data)})},e.redeploySelected=function(){e.confirm(event,{title:"Redeploy Nodes",message:"Are you sure you want to redeploy selected nodes?",yesCallback:function(){l.selected.forEach(function(e){e.id&&i("/api/v2/nodes/"+e.id+"/redeploy",{method:"PUT"}).then(function(){i.toast("Redeployed "+l.selected.length+" node"+(1===l.selected.length?"":"s"))},function(e){i.toast("Error Redeploying Node","node",e.data)})})}})},e.saveAttrib=function(){if(e.editing){var t=angular.copy(e.attribs);t.forEach(function(o){o.writable&&i("/api/v2/providers/"+e.id,{method:"POST",data:t},function(e){i.toast("Couldn't Save Attrib","attrib",e)})}),e.stopEditing()}},e.stopEditing=function(){e.editing&&(e.attribs=e._attribs,e.provider=e._providers[e.id],e.editing=!1)},e.startEditing=function(){e.editing&&1===e.hasAttrib||(e.editing=!0,e._attribs=angular.copy(e.attribs))},e.id=n.id,e.target={obj:"node_id",id:n.id},e.node={},e.hasAttrib=-1,e.attribs=[],e.serial=void 0,e.bmc=void 0,e.power=[],e.nics={},e.powers={identify:"lightbulb_outline",on:"settings_power",off:"power_settings_new",cycle:"loop",reboot:"settings_backup_restore",reset:"settings_backup_restore",halt:"gavel"},e.editing=!1;var c=!1;Object.keys(e._nodes).length?s():e.$on("nodesDone",function(){"undefined"==typeof e._nodes[e.id]?t.path("/nodes"):s()})}])}()}),require.register("js/profile.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("ProfileCtrl",["$scope","api","$location","$mdDialog","$mdMedia","$routeParams",function(e,t,o,n,r,a){var i="Profiles";e.attribs={},e.expand={},e.values={},e.profile_count=-1,e.valueOrder="key";var s=e.$watchCollection("_profiles",function(t){e.profile_count=Object.keys(t).length,e.values={},Object.keys(t).forEach(function(o){var n=t[o];e.values[o]=Object.keys(n.values).map(function(e){return{key:e,value:n.values[e]}})})});e.$on("$destroy",s),t("/api/v2/attribs").then(function(t){var o=t.data;e.attribs=o.reduce(function(e,t){return t.writable&&"undefined"!=typeof t.schema&&""!==t.schema&&(e[t.name]=t),e},e.attribs),e.profile_count=Object.keys(e._profiles).length}),e.$emit("title",i),a.id&&(e.expand[a.id]=!0),e.deleteProfile=function(o){e.confirm(event,{title:"Remove Profile",message:'Are you sure you want to remove "'+o+'" profile?',yesCallback:function(){t("/api/v2/profiles/"+o,{method:"DELETE"}).then(function(){t.getHealth();for(var n in e._profiles)e._profiles[n].name===o&&delete e._profiles[n];e.profile_count=Object.keys(e._profiles).length},function(){t.getHealth()})}})},e.createProfilePrompt=function(t,o){var r=angular.copy(o),a={},i="";if("undefined"!=typeof r){i=r.name;for(var s in r.values)a[s]={name:s,value:JSON.stringify(r.values[s])}}e.profile_count=1,n.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addprofiledialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{editing:"undefined"!=typeof r,attribs:e.attribs,profile:{name:i,values:a},original:angular.copy(r)},clickOutsideToClose:!0,fullscreen:!0})}}])}()}),require.register("js/provider.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("ProviderCtrl",["$scope","$location","$routeParams","api","$mdMedia","$mdDialog",function(e,t,o,n,r,a){function i(){e.editing||(e.provider=e._providers[e.id],e.provider?s||(s=!0,e.$on("provider"+e.provider.id+"Done",i)):t.path("/providers"))}e.$emit("title","Provider"),e.myOrder="name",this.getProviders=function(){var t=[];for(var o in e._providers)t.push(e._providers[o]);return t},e.loadProvider=function(t){return function(o){o.setValue(JSON.stringify(e.provider.auth_details[t],0,"  "),-1),o.getSession().on("change",function(){try{e.provider.auth_details[t]=JSON.parse(o.getValue())}catch(n){}})}},e.restructureNodes=function(e){return{order:e.name,status:n.getNodeStatus(e),name:e.name,icon:n.getNodeIcon(e),id:e.id}},e.$on("keyDown",function(t,o){13===o.key&&e.startEditing(),27===o.key&&e.stopEditing()}),e.deleteProvider=function(o){e.confirm(event,{title:"Delete Provider",message:"Are you sure you want to delete "+o.name+" Provider?",yesCallback:function(){n("/api/v2/providers/"+o.id,{method:"DELETE"}).then(function(){e._providers[o.id].name="DELETED-"+e._providers[o.id].name,n.toast("Deleted "+o.name+" capability"),n.getHealth(),t.path("/providers")},function(e){n.toast("Error Deleted Provider","capability",e.data)})}})},e.saveProvider=function(){if(e.editing){var t=angular.copy(e.provider);n("/api/v2/providers/"+e.id,{method:"PUT",data:t}).then(function(e){n.addProvider(e.data)},function(e){n.toast("Couldn't Save Provider","provider",e.data)}),e.stopEditing()}},e.stopEditing=function(){e.editing&&(e.provider=e._providers[e.id],e.editing=!1)},e.startEditing=function(){e.editing||(e.editing=!0,e.provider=angular.copy(e._providers[e.id]))},e.showAddProviderDialog=function(t,o){var n=r("sm")||r("xs"),i={name:o.toLowerCase(),description:"Not Set",type:o,auth_details:{}};for(var s in e.providerTemplates[o]){var l=e.providerTemplates[o][s];i.auth_details[s]=l["default"]}a.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addproviderdialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{providerTemplates:e.providerTemplates,provider:i},clickOutsideToClose:!0,fullscreen:n})},e.showAddNodeDialog=function(t){var o=r("sm")||r("xs"),n=[],i=void 0;for(var s in e._providers)n.push(e._providers[s]),"metal"!==e._providers[s].name&&"phantom"!==e._providers[s].name&&"undefined"==typeof i&&(i=s);a.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addnodedialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{base_name:"digital-rebar-node",_providers:n,hasProvider:n.length>0,provider:e.provider.id,_profiles:e.rawProfiles([]),profiles:[],add_os:"default_os",number:1,_deployments:e._deployments},clickOutsideToClose:!0,fullscreen:o})},e.id=o.id,e.provider=void 0,e.editing=!1;var s=!1;Object.keys(e._providers).length?i():e.$on("providersDone",i)}])}()}),require.register("js/provisioner.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("ProvisionerCtrl",["$scope","api","$location","$mdDialog","$mdMedia","$routeParams",function(e,t,o,n,r,a){var i=o.path().split("/")[2],s="Provisioner ";switch(i){case"bootenvs":s+="Boot Environments",t("/api/v2/attribs").then(function(t){e.attribs=t.data.map(function(e){return e.name})});break;case"templates":s+="Templates";break;case"machines":s+="Machines"}e.$emit("title",s),e.expand={},e.attribs=[];var l=function(){e.nodeMap={};for(var t in e._nodes){var o=e._nodes[t];e.nodeMap[o.uuid]=o}};l(),e.$on("nodesDone",l),a.id&&(e.expand[a.id]=!0),e.deleteTemplate=function(o){e.confirm(event,{title:"Remove Template",message:"Are you sure you want to remove this template?",yesCallback:function(){t("/provisioner/templates/"+o,{method:"DELETE"}).then(t.getHealth,t.getHealth)}})},e.createTemplatePrompt=function(e,t){var o=angular.copy(t),a=r("sm")||r("xs");n.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addtemplatedialog.tmpl.html",parent:angular.element(document.body),targetEvent:e,locals:{editing:"undefined"!=typeof o,template:o||{UUID:"",Content:""}},clickOutsideToClose:!0,fullscreen:a})},e.deleteBootEnv=function(o){e.confirm(event,{title:"Remove Boot Environment",message:"Are you sure you want to remove this boot environment?",yesCallback:function(){t("/provisioner/bootenvs/"+o,{method:"DELETE"}).then(t.getHealth,t.getHealth)}})},e.selectedFile="",e.selectFile=function(){document.getElementById("file").click()},e.upload=function(o){var n=document.getElementById("file");e.selectedFile="";var r=n.files[0],a=new FileReader;a.onloadend=function(e){var n=e.target.result;t("/provisioner/templates/"+o,{method:"PATCH",data:[{op:"replace",path:"/Contents",value:n}]}).then(function(){t.getHealth(),t.toast("Updated template")},function(e){t.getHealth(),t.toast("Error Updating template","template",e.data)})},a.readAsBinaryString(r),n.value=""},e.createBootEnvPrompt=function(t,o){var r=angular.copy(o);n.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addbootenvdialog.tmpl.html",parent:angular.element(document.body),targetEvent:t,locals:{editing:"undefined"!=typeof r,attribs:e.attribs,_provisioner:e._provisioner,env:r||{Name:"",OS:{Name:"",Family:"",Codename:"",Version:"",IsoFile:"",IsoSha256:"",IsoUrl:""},Kernel:"",Initrds:[],BootParams:"",RequiredParams:[],Templates:[]},original:angular.copy(r)},clickOutsideToClose:!0,fullscreen:!0})}}])}()}),require.register("js/rebar.js",function(e,t,o){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function t(t){return t.split("_").map(e).join("")}var o=angular.module("app");o.filter("from",function(){return function(e,t,o){var n=o&&o.id||0,r=[];return angular.forEach(e,function(e){e[t+"_id"]===n&&r.push(e)}),r}}),o.run(["$rootScope","$cookies","api",function(e,n,r){var a="https://"+location.hostname;e.host=n.get("host")||a,e.$on("updateApi",function(){function n(){r.reloading=!1}r.reloading=!0,r.getHealth(),r.getUsers(),o.types.forEach(function(o){r.queue.push(function(){r["get"+t(o)]().then(function(){e.$broadcast(o+"Done"),0===r.queue.length&&n(),r.nextQueue()},function(){0===r.queue.length&&n(),r.nextQueue()})})})}),e.$on("startUpdating",function(){r.reload(),r.getActive()}),e.tryFetch=function(){e.$emit("updateApi")},e._pollTimer,e._pollRate=15,e._pollRateOverride=!1,e._deployments={},e._deployment_roles={},e._roles={},e._nodes={},e._profiles={},e._networks={},e._network_ranges={},e._node_roles={},e._providers={},e._barclamps={},e.wizardBarclamps=[],e.showDNS=!1,e._DNS={zones:[]},e.showDHCP=!1,e._DHCP={subnets:[]},e.showProvisioner=!1,e._provisioner={bootenvs:[],templates:[],machines:[]},e._engine={},e._users={},e._tenants={},e._capabilities={}}]),o.factory("api",["$http","$rootScope","$timeout","$mdToast","debounce","localStorageService",function(e,r,a,i,s,l){function d(e,t,o){"undefined"==typeof o&&(o=0);for(var n in e)t.push(e[n]),e[n].depth=o,d(e[n].children,t,o+1)}var c=function(t,o){return o=o||{},o.method=o.method||"GET",o.headers=o.headers||{},o.api=!0,o.url=r.host+t,e(o)};return c.reloading=!1,o.types=["deployments","roles","nodes","profiles","node_roles","deployment_roles","networks","network_ranges","providers","barclamps"],c.testSchema=function(e,t){if("undefined"==typeof t)return!0;if("undefined"==typeof e&&!t.required)return!0;switch(t.type){case"any":return!0;case"str":if("string"!=typeof e)return!1;if(!t.pattern)return!0;var o=new RegExp(t.pattern.substr(1,t.pattern.length-2));return!!e.match(o);case"bool":return"boolean"==typeof e;case"int":return"number"==typeof e;case"seq":if("object"!==("undefined"==typeof e?"undefined":n(e))||!Array.isArray(e))return!1;var r=t.sequence[0];for(var a in e)if(!c.testSchema(e[a],r))return!1;return!0;case"map":if("object"!==("undefined"==typeof e?"undefined":n(e))||Array.isArray(e))return!1;if("undefined"!=typeof t.mapping["="]){var i=t.mapping["="];for(var s in e)if(!c.testSchema(e[s],i))return!1}else{for(var l in t.mapping){var d=t.mapping[l];if(!c.testSchema(e[l],d))return!1}for(var p in e)if("undefined"==typeof t.mapping[p])return!1}return!0}return!1},c.exampleFromSchema=function(e){if("undefined"==typeof e)return"";switch(e.type){case"any":return"="+(e.required?"*":"");case"str":return"string"+(e.required?"*":"")+(e.pattern?" "+e.pattern:"");case"bool":return"boolean"+(e.required?"*":"");case"int":return"number"+(e.required?"*":"");case"seq":var t=e.sequence[0];return t.required=e.required,[c.exampleFromSchema(t)];case"map":var o={};for(var n in e.mapping){var r=e.mapping[n];o[n]=c.exampleFromSchema(r)}return o}},c.lastUpdate=(new Date).getTime(),c.queue=[],c.queueLen=0,c.errors=l.get("errors")||[],c.toast=function(e,t,o){i.show(i.simple().textContent(e).position("bottom left").hideDelay(3e3)),t&&(c.errors.push({type:t,message:e,err:o,stack:(new Error).stack,date:Date.now()}),l.add("errors",c.errors))},c.get_id=function(e){var t={headers:{"x-return-attributes":'["id"]'}};return c(e,t)},c.fetch=function(e,o){var n={};return"node_role"===e&&(n={headers:{"x-return-attributes":'["id","name","deployment_id","role_id","node_id","state","cohort","run_count","status","available","order","created_at","updated_at","uuid","tenant_id","node_error"]'}}),c("/api/v2/"+e+"s/"+o,n).then(function(o){c["add"+t(e)](o.data)},function(t){return"Unauthorized\n"===t.data?void r.$broadcast(e+o+"Done"):(c.remove(e,o),void r.$broadcast(e+o+"Done"))})},c.reload=function(){r.$emit("updateApi"),c.lastUpdate=(new Date).getTime(),s(c.reload,18e4,!1)()},c.addQueue=function(e,t){c.queue.push(function(){c.fetch(e,t).then(c.nextQueue,c.nextQueue)})},c.nextQueue=function(){c.queue.length?r.$evalAsync(c.queue.splice(0,1)[0]):(c.queueLen=0,r._pollTimer=a(c.getActive,1e3*r._pollRate))},c.pollRate=function(e,t){t&&!r._pollRateOverride&&(r._pollRateOverride=!0),r._pollRate!==e&&(a.cancel(r._pollTimer),r._pollRate=e,console.debug("Polling Rate set to "+r._pollRate+" (override "+r._pollRateOverride+")"))},c.getActive=function(){var e=Math.ceil(((new Date).getTime()-c.lastUpdate)/1e3);c("/api/status/active",{method:"PUT",params:{age:e},data:{nodes:Object.keys(r._nodes).map(Number),deployments:Object.keys(r._deployments).map(Number)}}).then(function(e){var t=e.data;c.lastUpdate=(new Date).getTime();var o=function(e){t.changed[e].forEach(function(t){var o=/^.*(?=s)/.exec(e)[0];c.addQueue(o,t)})};for(var n in t.changed)o(n);for(var n in t.deleted)for(var r in t.deleted[n]){var a=t.deleted[n][r],i=/^.*(?=s)/.exec(n)[0];try{c.remove(i,a)}catch(s){console.warn(s)}}c.queueLen=c.queue.length,c.nextQueue()},function(e){console.warn(e),c.nextQueue()})},c.getHealth=function(){c("/health").then(function(e){var t=e.data.Map;r.showDNS="undefined"!=typeof t["dns-mgmt-service"],r.showDHCP="undefined"!=typeof t["dhcp-mgmt-service"],r.showProvisioner="undefined"!=typeof t["provisioner-mgmt-service"],r.showEngine="undefined"!=typeof t["rule-engine-service"],r.showEngine&&c("/rule-engine/api/v0/rulesets/").then(function(e){r._engine=e.data}),r.showDNS&&c("/dns/zones").then(function(e){r._DNS.zones=e.data}),r.showDHCP&&c("/dhcp/subnets").then(function(e){r._DHCP.subnets=e.data}),r.showProvisioner&&(c("/provisioner/machines").then(function(e){r._provisioner.machines=e.data}),c("/provisioner/templates").then(function(e){r._provisioner.templates=e.data}),c("/provisioner/bootenvs").then(function(e){r._provisioner.bootenvs=e.data}))},function(){r.showDNS=!1,r.showDHCP=!1,r.showProvisioner=!1})},c.getUsers=function(){c("/api/v2/users").then(function(e){var t=e.data;r._users={};for(var o in t)t[o].caps={},r._users[t[o].id]=t[o];c("/api/v2/user_tenant_capabilities").then(function(e){var t=e.data;for(var o in t){var n=t[o];r._users[n.user_id].caps[n.tenant_id]||(r._users[n.user_id].caps[n.tenant_id]={id:n.tenant_id,caps:[]}),r._users[n.user_id].caps[n.tenant_id].caps.push(n.capability_id)}}),c("/api/v2/tenants").then(function(e){var o=e.data;r._tenants={};for(var n in o){o[n].children=[],o[n].users=[],r._tenants[o[n].id]=o[n];for(var a in t)"undefined"==typeof t[a].caps[o[n].id]&&(t[a].caps[o[n].id]={id:o[n].id,caps:[]})}for(var i in t)r._tenants[t[i].tenant_id].users.push(t[i]);var s=[];for(var l in r._tenants){var c=r._tenants[l];"undefined"!=typeof c.parent_id&&r._tenants[c.parent_id]?r._tenants[c.parent_id].children.push(c):s.push(c)}r._tenantsInOrder=[],d(s,r._tenantsInOrder)})}),c("/api/v2/capabilities").then(function(e){var t=e.data;r._capabilities={};for(var o in t)r._capabilities[t[o].id]=t[o]})},c.remove=function(e,t){"undefined"!=typeof t&&r["_"+e+"s"][t]&&(console.log("removing "+e+" "+t),delete r["_"+e+"s"][t],r.$broadcast(e+t+"Done"),"deployment"===e&&["nodes","node_roles"].forEach(function(e){var o=/^.*(?=s)/.exec(e)[0];for(var n in r["_"+e]){var a=r["_"+e][n];a.deployment_id===t&&c.addQueue(o,n)}}))},c.addDeployment=function(e){var t=e.id;r._deployments[t]=e,r.$broadcast("deployment"+t+"Done")},c.getDeployments=function(){return c("/api/v2/deployments").then(function(e){r._deployments={},e.data.map(c.addDeployment)})},c.addNode=function(e){var t=e.id;e.address=e["node-control-address"];var o=r.states[e.state];e.alive||(o="off",e.reserved&&(o="reserved")),e.status=o,e.alive?(e.simpleState=2,e.state===-1&&(e.simpleState=1),0===e.state&&(e.simpleState=0)):e.simpleState=3,r._nodes[t]=e,r.$broadcast("node"+t+"Done"),r._pollRateOverride||(Object.keys(r._nodes).length>25?c.pollRate(45,!1):Object.keys(r._nodes).length>50&&c.pollRate(30,!1))},c.getNodes=function(){return c("/api/v2/nodes").then(function(e){r._nodes={},e.data.map(c.addNode)})},c.addProfile=function(e){var t=e.id;r._profiles[t]=e,r.$broadcast("profile"+t+"Done")},c.getProfiles=function(){return c("/api/v2/profiles").then(function(e){r._profiles={},e.data.map(c.addProfile)})},c.addRole=function(e){var t=e.id;r._roles[t]=e,r.$broadcast("role"+t+"Done")},c.getRoles=function(){return c("/api/v2/roles").then(function(e){r._roles={},e.data.map(c.addRole)})},c.addDeploymentRole=function(e){e.cohort=function(){return r._roles[e.role_id].cohort};var t=e.id;r._deployment_roles[t]=e,r.$broadcast("deployment_role"+t+"Done")},c.getDeploymentRoles=function(){return c("/api/v2/deployment_roles").then(function(e){r._deployment_roles={},e.data.map(c.addDeploymentRole)})},c.addProvider=function(e){var t=e.id;r._providers[t]=e,r.$broadcast("provider"+t+"Done")},c.getProviders=function(){return c("/api/v2/providers").then(function(e){r._providers={},e.data.map(c.addProvider)})},c.addNetwork=function(e){var t=e.id;r._networks[t]=e,r.$broadcast("network"+t+"Done")},c.addRange=function(e){var t=e.id;r._network_ranges[t]=e,r.$broadcast("network_range"+t+"Done")},c.getNetworkRanges=function(){return c("/api/v2/network_ranges").then(function(e){r._network_ranges={},e.data.map(c.addRange)})},c.getNetworks=function(){return c("/api/v2/networks").then(function(e){r._networks={},e.data.map(c.addNetwork)})},c.addNodeRole=function(e){var t=e.id;e.status=r.states[e.state],delete e.runlog,delete r._node_roles[t],r._node_roles[t]=e,r.$broadcast("node_role"+t+"Done")},c.getNodeRoles=function(){return c("/api/v2/node_roles",{headers:{"x-return-attributes":'["id","name","deployment_id","role_id","node_id","state","cohort","run_count","status","available","order","created_at","updated_at","uuid","tenant_id","node_error"]'}}).then(function(e){r._node_roles={},e.data.map(c.addNodeRole)})},c.addBarclamp=function(e){var t=e.id;if(r._barclamps[t]=e,r.$broadcast("barclamp"+t+"Done"),e.cfg_data&&"undefined"!=typeof e.cfg_data.wizard){if(!e.cfg_data.wizard)return;if(!e.cfg_data.wizard.version)return;if(2!==e.cfg_data.wizard.version)return;var o=!1;for(var n in r.wizardBarclamps){var a=r.wizardBarclamps[n];if(a.id===t){o=!0;break}}o||r.wizardBarclamps.push({id:t,title:e.cfg_data.wizard.name,icon:e.cfg_data.wizard.icon||"create_new_folder",path:"/workloads/"+t})}},c.getBarclamps=function(){return c("/api/v2/barclamps").then(function(e){r._barclamps={},e.data.map(c.addBarclamp)})},c.saveBarclamp=function(e){e.barclamp.source_path="API_uploaded";var t={value:e};c("/api/v2/barclamps",{method:"POST",data:t}).then(function(){c("/api/v2/barclamps/"+e.barclamp.name).then(function(e){c.addBarclamp(e.data)}),c.toast("Updated barclamp"),c.getRoles()},function(e){c.toast("Error Updating barclamp","barclamp",e.data)})},c.getNodeStatus=function(e){var t=Date.now();return"undefined"==typeof e?"error":e._statusTime&&e._statusTime+500>t?e._status:(e._statusTime=t,e.alive?e.available?e._status=r.states[e.state]:e._status="reserved":e._status="off")},c.getNodeIcon=function(e){var t=c.getNodeStatus(e);return"ready"===t?e.icon:r.icons[t]},c.truncName=function(e){return"undefined"==typeof e?"":e.substring(0,e.indexOf("."))},c}])}()}),require.register("js/roles.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("RolesCtrl",["$scope","debounce","$routeParams","$mdMedia","$mdDialog","api",function(e,t,o,n,r,a){function i(){if(!e.editing&&(e.role=e._roles[e.id],"undefined"!=typeof e.role)){for(var t in e._roles){var o=e._roles[t];"requires"in e.role&&e.role.requires.includes(o.name)?e.relations.Parents.push(o):"requires"in e._roles[t]&&e._roles[t].requires.includes(e.role.name)?e.relations.Children.push(o):"provides"in e.role&&e.role.provides.includes(o.name)?e.relations.Provides.push(o):"conflicts"in e.role&&e.role.conflicts.includes(o.name)&&e.relations.Conflicts.push(o)}if(e.metadata=e.role.metadata,"script"===e.role.jig_name&&e.role.metadata&&(e.scripts=e.role.metadata.scripts),"ansible-playbook"===e.role.jig_name&&e.role.metadata.files)for(var n in e.metadata.files)"string"==typeof e.metadata.files[n].body?e.metadata.files[n].temp=e.metadata.files[n].body:e.metadata.files[n].temp=e.metadata.files[n].body.join("\n");s||(s=!0,e.$on("role"+e.role.id+"Done",i))}}e.$emit("title","Roles"),e.query={page:1,limit:10},e.myOrder="name",e.flags=["library","implicit","bootstrap","discovery","cluster","destructive","abstract","powersave"],e.restructureRoles=function(t){return{order:t.cohort,status:t.status,name:e._nodes[t.node_id].name,icon:e.icons[t.status],id:t.id}},e.getRoles=function(){var t=[];for(var o in e._roles)t.push(e._roles[o]);return t},e.id=o.id,e.target={obj:"role_id",id:o.id},e.role={},e.metadata={},e.scripts=[],e.editing=!1,e.relations={Parents:[],Children:[],Provides:[],Conflicts:[]};var s=!1;e.retry=function(){Object.keys(e._node_roles).forEach(function(t){var o=e._node_roles[t];o.role_id===e.id&&a("/api/v2/node_roles/"+t+"/retry",{method:"PUT"}).then(function(t){a.addNodeRole(t.data),a.toast("Retried Role "+e.role.name+" on Node ID "+o.node_id)},function(e){a.toast("Error retrying node role","node_role",e.data)})})},e.assignDeployment=function(e,t){a("/api/v2/deployment_roles/",{method:"POST",data:{deployment_id:t,add_role:{role_id:e}}}).then(function(e){a.addDeploymentRole(e.data)},function(e){a.toast("Error Adding Deployment Role","deployment_role",e.data)})},Object.keys(e._roles).length?i():e.$on("rolesDone",i),e.removeSection=function(t){delete e.scripts[t],a.toast("Removed Script","role",t)},e.addSection=function(){var t='#!/bin/bash\necho "hello"\nexit 0\n';e.scripts.push(t)},e.saveScripts=function(){a("/api/v2/barclamps/"+e.role.barclamp_id).then(function(t){var o=t.data,n=o.cfg_data.roles;for(var r in n)if(n[r].name===e.role.name){delete n[r].metadata.scripts,n[r].metadata.scripts=[];for(var i in e.scripts)n[r].metadata.scripts.push(e.scripts[i]);a.saveBarclamp(o.cfg_data)}})},e.removeFile=function(t){e.metadata.files.splice(t,1),a.toast("Removed Ansible File","file",t)},e.addFile=function(){var t={type:"tasks",name:"main.yml",body:["---",'- debug: msg="Ansibile Metadata Role"','- debug: var="hints"','- debug: var="rebar_wall"']};e.metadata.files.push(t)},e.saveAnsible=function(){if("ansible-playbook"===e.role.jig_name&&e.metadata.files)for(var t in e.metadata.files)e.metadata.files[t].body=e.metadata.files[t].temp.split("\n");a("/api/v2/barclamps/"+e.role.barclamp_id).then(function(t){var o=t.data,n=o.cfg_data.roles;for(var r in n)if(n[r].name===e.role.name){n[r].metadata=e.metadata;for(var i in n[r].metadata.files)delete n[r].metadata.files[i].temp;a.saveBarclamp(o.cfg_data)}})}}])}()}),require.register("js/switches.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("SwitchesCtrl",["$scope","$location","debounce","$routeParams","$mdMedia","$mdDialog","api",function(e,t,o,n,r,a,i){e.$emit("title","Switches"),e.sweetches={},e.layout=[];for(var s=1;s<49;s+=2)e.layout.push(s);e.$on("nodesDone",function(){var t=[];for(var o in e._nodes)e._nodes[o].system||t.push(e._nodes[o].id);for(var n in t)i("/api/v2/nodes/"+t[n]+"/attribs/ports").then(function(t){var o=t.data,n=e._nodes[o.node_id];"undefined"==typeof o.value.lldp&&(console.log("switches: missing lldp data for node "+n.id+" using fake data for testing"),o.value=e.fakeValue(n.id));for(var r in o.value.lldp){var a=o.value.lldp[r].chassis.mac,i=o.value.lldp[r].port.descr,s=i.match(/([0-9]*)\/([0-9]*)\/([0-9]*)/),l=parseInt(s[3]);if(!e.sweetches[a]){for(var d={},c=1;c<49;c++)d[c]=[];
e.sweetches[a]={"switch":{mac:a,description:o.value.lldp[r].chassis.descr},ports:d}}e.sweetches[a][l]||(e.sweetches[a].ports[l]=[]);var p={id:n.id,name:n.name,nic:r};e.sweetches[a].ports[l].push(p)}})}),e.fakeValue=function(e){return{lldp:{eth0:{age:"0 day, 00:00:58",chassis:{Bridge:{enabled:"on"},Router:{enabled:"on"},descr:"Juniper Networks, Inc. qfx5100-24q-2p Ethernet Switch, kernel JUNOS 13.2X51-D38, Build date: 2015-06-12 02:33:47 UTC Copyright (c) 1996-2015 Juniper Networks, Inc.",mac:e%2===0?"20:4e:71:32:ca:fe":"20:4e:71:32:be:ef","mgmt-ip":"192.168.105.2",ttl:"120"},port:{descr:"xe-0/0/"+e%48+":1",local:"2"+e},rid:"1",via:"LLDP"},eth1:{age:"0 day, 00:00:58",chassis:{Bridge:{enabled:"on"},Router:{enabled:"on"},descr:"Juniper Networks, Inc. qfx5100-24q-2p Ethernet Switch, kernel JUNOS 13.2X51-D38, Build date: 2015-06-12 02:33:47 UTC Copyright (c) 1996-2015 Juniper Networks, Inc.",mac:e%2===0?"20:4e:71:32:be:ef":"20:4e:71:32:ca:fe","mgmt-ip":"192.168.105.2",ttl:"120"},port:{descr:"xe-0/0/"+(e+24)%48+":1",local:"3"+e},rid:"1",via:"LLDP"}},status:"Success"}}}])}()}),require.register("js/tenants.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("TenantsCtrl",["$scope","api","$mdDialog","$mdMedia","$routeParams",function(e,t,o,n,r){e.$emit("title","Tenants"),e.expand={},r.id&&(e.expand[r.id]=!0),e.deleteTenant=function(o){e.confirm(event,{title:"Remove Tenant",message:"Are you sure you want to remove this tenant?",yesCallback:function(){t("/tenants/"+o,{method:"DELETE"}).then(t.getUsers,function(e){t.getUsers(),t.toast("Error deleting tenants - "+e.data.message,"tenants",e.data)})}})},e.createTenantPrompt=function(r,a){var i=angular.copy(a),s=n("sm")||n("xs");o.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/addtenantdialog.tmpl.html",parent:angular.element(document.body),targetEvent:r,locals:{editing:"undefined"!=typeof i,tenants:e._tenants,tenant:i||{UUID:"",Content:""}},clickOutsideToClose:!0,fullscreen:s}).then(t.getUsers,t.getUsers)}}])}()}),require.register("js/users.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("UsersCtrl",["$scope","api","$mdMedia","$mdDialog","$routeParams",function(e,t,o,n,r){e.$emit("title","Users"),e.expand={},r.id&&(e.expand[r.id]=!0),e.getUserList=function(){var t=[];for(var o in e._users)t.push(e._users[o]);return t},e.deleteUser=function(o){e.confirm(event,{title:"Remove User",message:"Are you sure you want to remove this user?",yesCallback:function(){t("/api/v2/users/"+o,{method:"DELETE"}).then(t.getUsers,t.getUsers)}})},e.createUserPrompt=function(r,a){var i=angular.copy(a),s=o("sm")||o("xs");n.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/adduserdialog.tmpl.html",parent:angular.element(document.body),targetEvent:r,locals:{editing:"undefined"!=typeof i,user:i||{UUID:"",Content:""},tenants:e._tenants},clickOutsideToClose:!0,fullscreen:s}).then(t.getUsers,t.getUsers)},e.editCapsPrompt=function(r,a){var i=angular.copy(a),s=o("sm")||o("xs"),l=[];for(var d in e._capabilities)l.push(e._capabilities[d]);for(var c in e._tenants)"undefined"==typeof i.caps[c]&&(i.caps[c]={id:c,caps:[]});var p=angular.copy(i);n.show({controller:"DialogController",controllerAs:"dialog",templateUrl:"views/dialogs/editcapabilitiesdialog.tmpl.html",parent:angular.element(document.body),targetEvent:r,locals:{user:i,update:t.getUsers,original:p,tenants:e._tenantsInOrder,capabilitiesList:l,capabilities:e._capabilities},clickOutsideToClose:!0,fullscreen:s}).then(t.getUsers)}}])}()}),require.register("js/welcome.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("WelcomeCtrl",["$scope",function(e){e.$emit("title","Welcome to RackN Digital Rebar!")}])}()}),require.register("js/workloads.js",function(e,t,o){"use strict";!function(){angular.module("app").controller("WorkloadsCtrl",["$scope","api","$location","$mdDialog","$routeParams","localStorageService",function(e,t,o,n,r,a){e.$emit("title","Wizard");var i=this;this.required_service="",this.commit=!0,this.deployment_id=0,this.source="system",this.createDeployment=!0,this.use_system=!1,this.selected=[],this.attribs={},this.keys=[["",""]],e.submitStatus=0,e.done=0,e.status=0,e.steps=[{name:"Deployment",path:"views/wizard/deployment.html",icon:"directions_run",complete:function(){if(i.createDeployment){var t=i.name;if(!t)return!1}else{var o=e._deployments[i.deployment_id];if(!o)return!1}return i.use_system=!p.create_nodes,!0}},{name:"OS",path:"views/wizard/os.html",icon:"directions_bike",complete:function(){var e=p.system_nodes&&i.attribs["provisioner-target_os"]&&i.use_system,t=p.create_nodes&&i.provider;return e||t}},{name:"Attributes",path:"views/wizard/attributes.html",icon:"directions_car",complete:function(){return e.collectNodes(),!0}},{name:"Nodes",path:"views/wizard/nodes.html",icon:"directions_train",complete:function(e){if(0===i.selected.length)return!!e&&[!1,"You must select at least one node"];var t={},o={};for(var n in p.services){var r=p.services[n];t[r.name]=0,o[r.name]=!1}i.selected.forEach(function(n){var r=!1,a=!1;for(var i in p.services){var s=p.services[i],l=u[n.id][s.name];"control"===s.type&&(o[s.name]=!0),"required"===s.type&&(r=!0),l&&"required"===s.type&&(a=!0),l&&"control"===s.type&&t[s.name]++}if(!a&&r)return!!e&&[!1,"Every node must have a Required Service"]});for(var a in p.services){var s=p.services[a].name;if(t[s]%2!==1&&o[s])return!!e&&[!1,"An Odd Number of "+p.services[a].description+" Control Services is Required"]}return!e||[!0,""]}},{name:"Overview",path:"views/wizard/overview.html",icon:"airplanemode_active",complete:function(){return!0},onStep:function(){e.submitStatus=0,t("/api/v2/deployments"+(i.createDeployment?"":"/"+i.deployment_id+"/batch"),{method:i.createDeployment?"POST":"PUT",data:e.generateBlob()}).then(function(){e.submitStatus=1},function(o){t.toast("Error Running Wizard","deployments",o.data),e.submitStatus=-1})}},{path:"views/wizard/done.html",complete:function(){return!1},finalStep:!0}],e.editInHelper=function(){a.add("api_helper_payload",JSON.stringify(e.generateBlob(),null,"  ")),a.add("api_helper_method",i.createDeployment?"post":"put"),a.add("api_helper_route",i.createDeployment?"/api/v2/deployments":"/api/v2/deployments/"+i.deployment_id+"/batch"),o.path("/api_helper")},e.setProgress=function(t){t<=e.status&&(e.done=t)},e.canNext=!1,e.setCanNext=function(){e.canNext=!0},e.nextStep=function(){e.status>e.done?(e.done++,e.canNext=!1):e.status===e.done&&e.steps[e.done].complete()&&(e.steps[e.done].onStep&&e.steps[e.done].onStep(),e.done++,e.status++,e.canNext=!1)},e.prevStep=function(){e.done>0&&e.done--},e.getDeployments=function(){var t=[];for(var o in e._deployments){var n=e._deployments[o];n.system||t.push(n)}return t},e.providerMap={};for(var s in e._providers){var l=e._providers[s];e.providerMap[l.name]=l,"MetalProvider"!==l.type&&""!==l.type&&(this.provider=l.name)}e.showAdvanced=!1,e.toggleAdvanced=function(){e.showAdvanced=!e.showAdvanced};var d=r.id;if("undefined"==typeof e._barclamps[d]||"undefined"==typeof e._barclamps[d].cfg_data.wizard)return void e.setPath("/deployments");var c=e.barclamp=e._barclamps[d],p=e.wizard=c.cfg_data.wizard,u=e.serviceMap={};e.$emit("title",p.name+" Wizard"),this.name=c.cfg_data.barclamp.name,e.osList=[],p.system_nodes&&t("/api/v2/nodes/system-phantom.internal.local/attribs/provisioner-available-oses").then(function(t){var o=t.data;if(o.value){e.osList=Object.keys(o.value);var n=c.cfg_data.barclamp.os_support;for(var r in e.osList)n&&n.length&&n.indexOf(e.osList[r])===-1&&e.osList.splice(r,1);e.osList.length&&(i.attribs["provisioner-target_os"]=e.osList[0])}}),e.attribMap={},t("/api/v2/attribs").then(function(t){var o=t.data;for(var n in o){var r=o[n];e.attribMap[r.name]=r}for(var a in p.base_attribs){var s=p.base_attribs[a];"undefined"==typeof i.attribs[s]&&(i.attribs[s]=e.attribMap[s]["default"].value)}for(var l in p.advanced_attribs){var d=p.advanced_attribs[l];"undefined"==typeof i.attribs[d]&&(i.attribs[d]=e.attribMap[d]["default"].value)}},function(e){t.toast("Error fetching Attribs","attribs",e.data)}),e.roles=[],e.roleMap={};for(var m in e._roles){var f=e._roles[m];e.roleMap[f.name]=f}for(var v=0;v<p.services.length;v++){var h=p.services[v].type;if("required"===h){i.required_service=p.services[v].name;break}}e.newId=-1,e.createdNodes=[],e.systemNodes=[],e.createNodes=function(){if(e.createdNodes=[],p.create_nodes)for(var t=0;t<p.services.length;t++){var o=p.services[t].name,n=p.services[t].type,r=p.services[t].count;if(r>0&&("control"===n||"worker"===n))for(var a=0;a<r;a++){var s=e.newId--,l={id:s,name:-s+"-create-"+o+"-"+(a+1),order:s};u[s]={},u[s][n]=!0,""!==i.required_service&&(u[s][i.required_service]=!0),e.createdNodes.push(l),i.selected=e.createdNodes}}},e.createNodes(),e.addNodes=function(){var t=e.newId--,o={id:t,name:-t+"-added-node",order:t};u[t]={},""!==i.required_service,u[t][i.required_service]=!0,u[t].worker=!0,e.createdNodes.push(o),i.selected=e.createdNodes},e.collectNodes=function(){if(e.systemNodes=[],p.system_nodes&&i.use_system){var t=0;for(var o in e._deployments){var n=e._deployments[o];if(n.system){t=o;break}}Object.keys(e._nodes).forEach(function(o){var n=e._nodes[o],r=t;for(var a in e._deployments)if(e._deployments[a].name===i.source){r=e._deployments[a].id;break}if(!n.system&&n.deployment_id===r){u[o]={};for(var s=0;s<p.services.length;s++){var l=p.services[s].type,d=p.services[s].count;if(d>0&&("control"===l||"worker"===l)){u[o][l]=!0,p.services[s].count--;break}}""!==i.required_service&&(u[o][i.required_service]=!0),console.log("adding node "+n.name+" from deployment id "+r),e.systemNodes.push(n),i.selected=e.systemNodes}})}},e.select=function(e,t){var o=u[e.id][t.name],n=void 0;switch(t.type){case"required":if(o)return;for(var r in u[e.id]){for(var a in p.services)if(p.services[a].name===r){n=p.services[a];break}n&&"required"===n.type&&(u[e.id][r]=!1)}u[e.id][t.name]=!0;break;case"control":if(o)u[e.id][t.name]=!1;else{for(var s in u[e.id]){for(var l in p.services)if(p.services[l].name===s){n=p.services[l];break}n&&"worker"===n.type&&(u[e.id][s]=!1)}u[e.id][t.name]=!0}break;case"worker":if(o)u[e.id][t.name]=!1;else{for(var d in u[e.id])for(var c in p.services)if(p.services[c].name===d){n=p.services[c];break}u[e.id][t.name]=!0}break;default:u[e.id][t.name]=!u[e.id][t.name]}i.selected.includes(e)||i.selected.push(e)},e.getNodes=function(){return i.use_system?e.systemNodes:e.createdNodes},e.generateBlob=function(){console.log("JSON generate starting");var t={commit:i.commit,attribs:i.attribs};if(i.createDeployment&&(t.name=i.name),!i.use_system){var o=e.providerMap[i.provider].auth_details["provider-create-hint"];if(!o){var n=e.providerMap[i.provider].type;o=e.providerTemplates[n]["provider-create-hint"]["default"]}t.provider={name:i.provider,hints:o}}console.log("JSON generating nodes in "+t);var r=0,a=0;t.nodes=[],i.selected.forEach(function(o){var n=o.id,s=[];console.log("JSON generate adding roles to node "+o);for(var l in p.services){var d=p.services[l],c=u[o.id][d.name];if(c)for(var m in d.roles){var f=d.roles[m];for(var v in f){var h=f[v];u[o.id][m]&&s.indexOf(h)<0&&s.push(h)}}}if(s=s.sort(),n>0)t.nodes.push({id:e._nodes[n].name,roles:s});else{var g=!1;for(var y in t.nodes){var _=t.nodes[y];if(!("string"==typeof _.id||_.id>0)&&JSON.stringify(_.roles)===JSON.stringify(s)){_.count++,g=!0;break}}g||(a+=1,t.nodes.push({id:-++r,prefix:i.name+"-group-"+a,roles:s,count:1}))}}),console.log("JSON generate adding keys");for(var s in i.keys)if(i.keys[s]){var l=i.keys[s];l&&l[1].length>20&&(t.public_keys||(t.public_keys={}),t.public_keys[l[0]]=l[1])}return console.log("JSON generate apply order"),p.role_apply_order&&p.role_apply_order.length>1&&(t.role_apply_order=p.role_apply_order),t}}])}()}),require.register("___globals___",function(e,t,o){})}(),require("___globals___");